	Program macpuf
C This source code is from Havenith (below) and Mike Dean
C has made very minor changes to enable compilation on OS X
C using gfortran.
C
C This is the only complete version of Fortran source that I
C have in digital format, and should not receive significant
C alterations without being backed up first.
C
C July 10, 2011 is the day I figured out how to compile this
C using gfortran in Lion OS X.
C
C subject: part1 of mcpuff with hr modification
C
C  SIMULATION OF HUMAN VENTILATION, PULMONARY GAS EXCHANGE,
C  GAS TRANSPORT, METABOLISM, AND ACID-BASE REGULATION
C
C++++++++++++++++++++++++++++++++++++++++++++++++++++++
C                         VERSION 17 DECEMBER 1981
C
C        GEORGE HAVENITH DEPT. OF  THEORETICAL BIOLOGY
C                        TRANS 3     PADUALAAN 8
C                             UTRECHT
C
C  CHANGES IN DELAY, CARDIAC OUTPUT, TISSUE RESPIRATORY QUOTIENT,
C  LACTIC ACID CATABOLISM, AND BUFFERING BY BICARBONATE
C CHANGED:VE RRATE RELATION, CALCULATION OF ALVEOLAR GAS PRESSURES
C AND INCORPORATION OF HEART RATE
C
C    THIS VERSION INCORPORATES CALCULATION OF A PERFORMANCE INDEX
C    FOR THIS PURPOSE A DATASET *DATAF* IS NEEDED.
C    THE FIRST CALCULATIONS ARE MADE AFTER 10 MINUTES OF SIMULATION
C       SO A TEN MINUTE 'REST' PERIOD IS NECCESARY.
C
C  ALL CHANGES ARE SHOWN BETWEEN COMMENT CARDS:  C+++++++++++++
C
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C          AUTHORS - C.J.DICKINSON AND D.INGRAM
C          (ST.BARTHOLOMEW'S HOSPITAL MEDICAL COLLEGE, LONDON, ENGLAND)
C       E.J.M.CAMPBELL, N.L.JONES, A.S.REBUCK, AND K.AHMED
C          (MCMASTER UNIVERSITY MEDICAL SCHOOL, HAMILTON, ONT., CANADA)
C
C       FOR ADDITIONAL INFORMATION @ STUDENT HANDBOOKS WRITE TO
C           SOFTWARE SUPERVISOR, COMPUTATION SERVICES UNIT,
C           MCMASTER UNIV. MEDICAL CENTRE, MAIN ST.(WEST),
C           HAMILTON, ONTARIO, CANADA, LBS 4J9
C
C  N.B. THIS VERSION SLIGHTLY AMENDS AND IMPROVES THE COMPLETE PROGRAMME
C    IN 'A COMPUTER MODEL OF HUMAN RESPIRATION' (BY C.J.DICKINSON -
C    PUBLISHED IN 1977 BY MTP PUBLISHING CO. LTD., LANCASTER, U.K.).
C    IT ALSO ECONOMISES A LITTLE ON EXECUTION TIME.  THE MINOR SUGGESTED
C    AMENDMENTS ARE SHOWN BETWEEN COMMENT CARDS BEGINNING
C    C-------- AND ENDING C........(FOR EACH CORRECTION OR CHANGE)
C
C*** N.B. ALL LOCAL ARRANGEMENTS WHICH OTHER USERS MIGHT WISH TO CHANGE
C WHEN SETTING UP 'MACPUF' ON THEIR OWN SYSTEMS ARE DESIGNATED BY A
C COMMENT CARD BEGINNING 'C***'
C
C T CONTAINS 120 FACTORS WHICH ARE PARAMETERS AND ALSO COMPD. VARIABLES
C TJJ IS USED FOR OUTPUT OF COLUMNS OF SELECTED VARIABLES.
C NO USED FOR INITIALISING SAME. NTAB - SEE 'EQUIVALENCE' ST. BELOW.
C ARRAY C CONTAINS PARAMETERS FOR EACH RUN, COMPUTED BY S/R CONST
C-------- INCREASED C ARRAY SIZE
      DIMENSION T(120),TJJ(8),NO(23),NTAB(23),C(75),FUN1(10),FUN2(20),
     X FUN3(20)
C
C+++++++++++++++++++++++++++++++++++++++
C ARRAYS FOR PERFORMANCE CALCULATIONS
      DIMENSION OARS(31,8),QARS(31,8),PI(8)
C
C........
C INI,KT,KL = INPUT/OUTPUT NOS.; NW1,NW2,JKL,ITRIG AND NEOF USED IN
C INTERACTIVE DIALOGUE (S/R NXTWD). NW=1(NEW), NW=0(CHANGED SUBJECT)
C------ NPRT CONTROLS OUTPUT. NPRT=0 SUPPRESSES, NPRT>0 GOES AS BEFORE.
C       LDISP AND KA ARE ADDED SO THAT THE COMMON STORE OF 'MACPUF'
C       CORRESPONDS WITH THAT OF THE MASTER CAI DRIVER 'MACAID'.
C       INDICES NPRT,LDISP AND KA ARE NOT USED AT ALL BY MACPUF WHEN
C       RUNNING ON ITS OWN
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,
     X    NW
        COMMON /PLOT/ KPLOT,KDATF,WRATE,EFFIC,FUN3
        COMMON /KWVTT/ KWVT,CATLIV,CATCID,CATMUS,AFBR1,AFBR2,PROD,
     X CATOX
C..........
C NFLAG IS SPARE (INIT.=1) FOR CODING ANY USER'S SPECIAL INSTRUCTIONS
C J3 + ND=TIME. ISPAR-NC, ALSO MT, CODE OUTPUT INSTRUCTIONS
        COMMON NFLAG,J3,ISPAR,NA,NB,NC,ND,NE(8)
C NARTI (1= NAT., 0= ARTIF.) VENTLN. K2+K4 CONCERN SYMPTOMS (S/R SYMPT)
C INDEX IS POINTER IN DELAY LINE, S/R DELAY.
        COMMON NARTI,MT,K2,K4,INDEX
C FIO2,C2=FRACT.INSPIRED GASES,AS PERCENT;CO=CARDIAC OUTPUT;
C PD,PR=MANUAL ADJ.OF TISSUE METABOLISM AND BREATHING
C CAPACITY;BULLA=EXTRA DEAD SPACE;VLUNG=LUNG VOL;HB=HAEMOGLOBIN;
C PCV=PCV;V- OR FADM=VENOUS ADMIXT.PERCENT;AZ-CZ=VENT.CONTROLS BY PCO2
C PO2 + BRAIN;BARPR=BARO.PRESS.;TEMP=TEMPERAT.;TRQ=TISS.RQ;
C TVOL=TISS.VOL;VBLVL=VENOUS BL.VOL;ADDC3=ADDN. OF BICARB.;
C BAG=BAG VOL.FOR REBREATHING EXPTS;ALL -VENT TERMS EXPLAINED
C LATER;CONSO=O2 CONSUMP;SAT=ART.O2 SATN.;CBF=CEREB.BL.FLOW.
C MOST OTHERS NOT EXPL.IN TEXT MADE UP AS FOLLOWS: 1ST LETTER
C B=BRAIN,P=IDEAL PULM.CAPILL,R=ARTERIAL,E=EFFLUENT ARTERIAL,S=SLOW
C TISSUE STORES,U=BUBBLE STORES(FOR NITROGEN),V=VENOUS,A=ALVEOLAR,
C T=TISSUE;2ND-3RD LETTERS C2=CO2,O2=O2,N2=N2,PH=PH,C3=HCO3 ADJUSTMENTS;
C LAST 2 LETTERS PR=PRESS.,MT=AMT.AMOUNT IN ML,CT=CONTENT IN ML:OR MMOL;
C RF=REFERENCE VALUES; AJ=ADJUSTING VALUES.X109+X110 ARE UNUSED AND
C ARE AVAILABLE FOR ANY SPECIALISED PURPOSES OF AN INDIVIDUAL USER
C+++++++++++++++++++++++++++
C X109 AND X110 USED AS HRATE (HEARTRATE) AND STRVL (STROKEVOLUME)
C+++++++++
        COMMON FIO2,FIC2,CO,PD,FADM,BULLA,VLUNG,ELAST,VADM,AZ,
     X    BZ,CZ,BARPR,TEMP,TRQ,TC2MT,TVOL,HB,PCV,VBLVL,
     X    ADDC3,BC3AJ,DPG,PR,FITNS,SPACE,COMAX,SHUNT,VC,PEEP,
     X    VO2CT,RCOAJ,RPH,VPH,FVENT,BPH,BAGO,BAGC,AO2MT,AC2MT,
     X    AO2PR,AC2PR,DPH,XLACT,BO2PR,BC2PR,TIDVL,RRATE,RO2CT,VC2MT,
     X    DVENT,SVENT,PC2CT,PO2CT,TO2CT,TC2CT,BO2CT,BC2CT,TPH,RC3CT,
     X    VC2CT,RO2MT,RC2MT,XRESP,AN2MT,BO2MT,BC2MT,CBF,PC,DSPAC,
     X    REFLV,RO2PR,CONSO,RC2PR,PG,PJ,TND,RC2CT,QB,PW,
     X    FT,CONOM,BUBBL,TC2RF,TC3MT,VC3MT,TC3CT,VC3CT,TLAMT,RLACT,
     X    BC3CT,BO2AD,COADJ,EO2CT,TO2MT,TO2PR,TC2PR,VO2MT,AVENT,PL,
     X    EC2CT,TN2MT,TN2PR,FEV,SN2PR,EN2CT,UN2MT,RN2MT,HRATE,STRVL,
     X    TC3AJ,SN2MT,QA,RVADM,XDSPA,BAG,XMALE,HT,WT,AGE
C*** LOCAL ARRANGEMENTS
C COMMON TDLAY IS USED FOR GREATER ACCURACY, PROVIDING A DELAY IN VENOUS
C RETURN. ifS/R DELAY IS NOT USED THIS COMMON BLOCK CAN BE REMOVED
C++++++++++++++++++++++++
C       TDLAY 80  FOR  DELAY CHANGE
      COMMON TDLAY(80)
C COMMON NDUMP + TDUMP ARE ONLY USED FOR STORE/BACKTRACK (S/R DUMP)
      COMMON NDUMP(20),TDUMP(160)
C EQUIV.STATEMENT BELOW ECONOMISES ON LOCATIONS OF MULTI-USED LOCAL
C VARIABLES, AND MAKES LOCAL VARIABLES COMPUTED OUTSIDE MAIN 'DO' LOOP
C EQUIVALENT TO VALUES OF ARRAY C() PRECALULATED BY S/R CONST
C*** LOCAL ARRANGEMENTS
C THE WHOLE EQUIVALENCE OF C() CAN BE REMOVED AND VALUES FROM S/R
C CONST INSERTED IN THE PROGRAMME. THIS RUNS SLOWER, BUT SMALL STORE
C COMPUTERS MAY NOT ALLOW THE COMPLETE EQUIVALENCE STATEMENT BELOW
C-------- C(N) REPLACED BY CN BELOW AND THROUGHOUT MAIN PROGRAMME
        EQUIVALENCE (C1,C(1)),(C2,C(2)),(C3,C(3)),(C4,C(4))
     X ,(C5,C(5)),(C6,C(6)),(C7,C(7)),(C8,C(8)),(C9,C(9))
     X ,(C10,C(10)),(C11,C(11)),(C12,C(12)),(C13,C(13)),(C14,C(14))
     X ,(C15,C(15)),(C16,C(16)),(C17,C(17)),(C18,C(18)),(C19,C(19))
     X ,(C20,C(20)),(C21,C(21)),(C22,C(22)),(C23,C(23)),(C24,C(24))
     X ,(C25,C(25)),(C26,C(26)),(C27,C(27)),(C28,C(28)),(C29,C(29))
     X ,(C30,C(30)),(C31,C(31)),(C32,C(32)),(C33,C(33)),(C34,C(34))
     X ,(C35,C(35)),(C36,C(36)),(C37,C(37)),(C38,C(38)),(C39,C(39))
     X ,(C40,C(40)),(C41,C(41)),(C42,C(42)),(C43,C(43)),(C44,C(44))
     X ,(C45,C(45)),(C46,C(46)),(C47,C(47)),(C48,C(48)),(C49,C(49))
     X ,(C50,C(50)),(C51,C(51)),(C52,C(52)),(C53,C(53)),(C54,C(54))
     X ,(C55,C(55)),(C56,C(56)),(C57,C(57)),(C58,C(58)),(C59,C(59))
     X ,(C60,C(60)),(C61,C(61)),(C62,C(62)),(C63,C(63)),(C64,C(64))
     X ,(C65,C(65)),(C66,C(66)),(C67,C(67)),(C68,C(68)),(C69,C(69))
     X ,(C70,C(70)),(C71,C(71)),(C72,C(72)),(C73,C(73)),(C74,C(74))
     X ,(C75,C(75))
C........
        EQUIVALENCE(ITRIG(73),NTAB(1)),(FIO2,T(1))
      DATA NO/0,1,1,1,0,1,18,0,1,0,69,33,51,35,60,41,72,74,1,1,0,0,1/
C LL1=1 IS NORMAL; 2 IS DEATH; 3 IS ARITH. ERROR
C 'E' SPECIFIES V.SMALL QUANTITY TO AVOID ZERO DIVISIONS
      DATA E/.00000001/
C
      DATA FUN1(1), FUN1(2), FUN1(3), FUN1(4), FUN1(5), FUN1(6),
     X FUN1(7), FUN1(8), FUN1(9), FUN1(10) /250.,.80,450.,.86,1320.,.87,
     X 2100.,.90,3150.,1.00/
C
C
      DATA FUN2(1), FUN2(2), FUN2(3), FUN2(4), FUN2(5), FUN2(6),
     X FUN2(7), FUN2(8), FUN2(9), FUN2(10), FUN2(11), FUN2(12),
     X FUN2(13), FUN2(14), FUN2(15), FUN2(16), FUN2(17), FUN2(18),
     X FUN2(19), FUN2(20) /450.,.2700,578.,.280,626.,.402,730.,
     X 1.990,734.,2.000,860.,8.000,1010.,14.00,1130.,23.500,
     X 2500.,5.500,3500.,0.3500/
C
C SET UP DAMPING AND PH FUNCTIONS FOR USE LATER
      DAMP(X,Y,Z)=(X*Z+Y)/(1.+Z)
      PHFNC(X,Y)=6.1+ALOG(X/(.03*Y))*.434294482
C-------- LL2 DELETED, LL5 SET TO ZERO, DATA STATEMENT IS REPLACED
      LL1=10
      LL3=17
      LL5=0
C
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C    BUILDING FILES FOR PLOTOUTPUT (INCAR) AND
C    DATAFILE FOR CALCULATION OF PERFORMANCE INDEX
C
C     CALL FILES
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C*** LOCAL ARRANGEMENTS
C INI=INPUT, KT=OUTPUT DEVICE (TERMINAL), KL=OUTPUT DEVICE (FOR PLOTS)
C+++++++++++ KPLOT FOR ERGOMETER PLOTS
      INI=5
      KT=6
      KL=6
      KPLOT=8
      KWVT=8
      KDATF=10
C INITIALIZE ALL INDICES FOR STANDARD OUTPUT,ETC AND PRINT OPENING
      DO 100 I=1,23
  100 NTAB(I)=NO(I)
C-------- CHANGES TO INTERFACE WITH MCAID DRIVER (MCAID=1)
      MCAID=0
C     MCAID=1
      if(MCAID) 108,108,102
102   NW1=1
      NW2=20
      JKL=0
      CALL NXTWD (0,XXX,I,0,1)
      NPRT=I
      GO TO 170
  108 NPRT=1
C............
      WRITE (KL,110)
  110 format(' -- MACPUF -- VERSION 79.2 -- 21 APRIL 1979
     X',/,' INPUT FOR WORK LOAD IN WATTS EXTERNAL ENERGY',/,
     X ' CALCULATES HEART RATE AND STROKE VOLUME',/,
     X' CHANGED VERSION 17 DECEMBER 1981; GEORGE HAVENITH',/)
C INITIALIZE ALL WORKING VALUES FOR A NEW SUBJECT
C-------- NEW PARAMETER TO INTERFACE WITH MCAID DRIVER
  170 CALL MINIT (MCAID,LL1,LL3,LL4,NREPT,SIMLT)
C++++++++++++++++++++++++++++
C INITIALIZE,WRATE FOR REST
      WRATE=1.0
      ISPAR=3
      NA=60
C............
C COMPUTE WORKING PARAMETERS UNCHANGED DURING THE RUN
  190 CALL CONST (C,NREPT,SIMLT)
C MAIN PROGRAMME LOOP OPERATES EVERY FT(FRACTIONAL TIME) MINUTE(S)
      DO 1590 MORAN=1,NREPT
C ifBAG REBREATHING IN ACTION MAKE INSPIRED GASES SAME AS IN BAG
      if(PL-1.5) 210,210,200
  200 CALL BAGER (2,C12,C12,C12,SIMLT)
C INCREMENT LOOP COUNTER
  210 LL4=LL4+1
C NEXT AUTOMATICALLY INCREASES CARDIAC OUTPUT ifO2 SUPPLIED IS LOW
      Y=RO2CT*.056
C-------- REDUCES CARDIAC OUTP. INC. WITH HYPOXIA - PREV. TOO BIG
  220 if(Y-.4) 230,240,240
  230 Y=.4
C COADJ IS ADJUSTED CARD.OUTPUT,USED MAINLY AS INDEX FTCO
C WHICH TAKES ACCOUNT OF CARD.OUTPUT PER UNIT TIME.
C OUTPUT GOES UP AS TOTAL O2 CONSUMPTION INCREASES.
C+++++++++++++++++++++++ CO TRANSFERRED TO INFLUENCE STOKEVOL.
  240 COADJ=DAMP(((C8+C9)/Y),COADJ,C61)
C++++++++++++++++
C........
C++++++++++++++++++++++++++++++++++++++++++++++++
C INCORPORATION OFHEART RATE AND STROKEVOLUME
       X=(-.3*COADJ**2.+11.*COADJ+30.)
       if(COADJ.GE.20.) X=130.
C STRVOL IN LITERS
      STRVL=C75*X/130000.
       HRATE=COADJ/STRVL
C LIMIT CARDIAC OUTPUT THROUGH STROKE VOLUME AND HEART RATE
       if(HRATE.LE.C74) GOTO 242
       HRATE=C74
       COADJ=HRATE*STRVL
  242  CONTINUE
C++++++++++++++++++++++++++++++++++++++++++++++++++++
      if(CO-3.) 250,260,260
C ifHEART STOPPED MAKE OUTPUT AT ONCE ZERO TO STOP ARTERIAL
C COMPOSITION CHANGING - 'E' IS A VERY SMALL NUMBER(DATA)
  250 COADJ=E
C+++++++++++++ ifHEART STOPS, HRATE=0
      HRATE=E
      GO TO 280
C++++++++++++++++++++++++++++++++++++++++++++++++++
CCARDIACOUTPUT NOW LIMITED THROUGH STROKEVOLUME
  260  CONTINUE
  270  CONTINUE
C++++++++++++++++++
C LIMIT MAXIMUM CARDIAC OUTPUT
C 260 if(COADJ-COMAX) 280,280,270
C 270 COADJ=COMAX
C FTCO IS NO. OF 100 ML PORTIONS OF BLOOD CIRCULATING PER FRACTIONAL
C TIME INTERVAL
  280 FTCO=C17*COADJ
      FTCOC=FTCO*(1.-C69*COADJ)
C O2 CONT.OR PRESS. INFLUENCES VEN. ADMIXTURE AND (V.SLOWLY) 2,3-DPG
C-------- C71-72 NEW PARAMETERS, AMENDING RATE OF CHANGE OF 2,3-DPG
      DPG=DPG+(C71-RO2CT-DPG)*C72
C........
      X=AO2PR
      if(X-200.) 300,300,290
  290 X=200.
C INCREASE EFF.VEN.ADM.ifALV.PO2 VERY HIGH
  300 Y=AO2PR
      if(Y-600.) 320,320,310
  310 Y=600.
  320 if(AO2PR-400.) 340,340,330
  330 X=X-(Y-400.)*.3
  340 if(X-55.) 350,350,360
  350 X=55.
C PW=EFFECTIVE VENOUS ADMIXTURE, AFFECTED BY PEEP, ALV.PO2, ETC
C AND ALSO INCORPORATING A FIXED SHUNT COMPONENT, FADM
  360 PW=(C18/X+C19)*C21+FADM
C LIMIT RIDICULOUS ADMIXTURES EXCEEDING 100
      if(PW-100.) 380,380,370
  370 PW=100.
  380 X=PW*.01
      PC=1.-X
C ART.CO2 + O2 AMOUNTS INCREMENTED BY MIXTURE OF PURE VENOUS
C AND PURE IDEALIZED PULM.CAP.BLOOD,DETERM.BY RATIOS X AND PC
C NITROGEN CONTENT IS DETERMINED HERE IN TERMS OF PARTIAL PRESURES
C ASSUMING A LINEAR DISSOC. CURVE
      RN2MT=RN2MT+FTCO*((X*TN2PR+PC*(C11-AO2PR-AC2PR))*.00127-EN2CT)
      U=X*VC2CT+PC*PC2CT
      V=X*VO2CT+PC*PO2CT
      RC2MT=RC2MT+FTCO*(U-EC2CT)
      RO2MT=RO2MT+FTCO*(V-EO2CT)
C CONTENTS PASSING TO TISSUES AFFECTED BY RATES OF BLOOD FLOW
      W=C22/COADJ
C ifHEART STOPPED PREVENT CHANGES IN ART.BLOOD COMPOSITION
      if(W-100.) 400,400,390
  390 W=0.
  400 EO2CT=DAMP(RO2MT*.1,EO2CT,W)
      EC2CT=DAMP(RC2MT*.1,EC2CT,W)
      EN2CT=DAMP(RN2MT*.1,EN2CT,W)
      Z=COADJ*C17
C R-2CT IS CONTENT OF BLOOD REACHING CHEMORECEPTORS
      RO2CT=DAMP(V,RO2CT,Z)
      RC2CT=DAMP(U,RC2CT,Z)
C O2CON AND C2CON ARE USED EVERY TIME FOR ENTERING S/R GASES. BEFORE
C ENTERING S/R GASES (DISSOC.CURVES) SET CONTENTS OF O2 + CO2 FOR ART.
C BLOOD, SAME FOR BICARB.(HCO3),WHICH HAS TO TAKE ACCOUNT OF IN VITRO
C INFLUENCE OF ART.PCO2 ON BICARB.CONC. SO THAT PH CAN BE CALCULATED.
C LIMITS SET TO PREVENT ARITHMETIC ERRORS
      RC3CT=C3*(RC2PR-40.)+VC3MT*C1
      if(RC3CT) 940,940,410
C ENTER ART.BICARB.,CALC.PH AND ENTER VALUE INTO RPH (ART. PH)
  410 RPH=PHFNC(RC3CT,RC2PR)
C USE TEST ROUTINE GSINV TO INVERT GASES
C+++ (REPLACES ITERATIVE REVERSAL ROUTINE IN PREVIOUS VERSIONS)
      CALL GSINV (RO2PR,RC2PR,RO2CT,RC2CT,RPH,SAT)
C STORE ARTERIAL SATN. AS PERCENTAGE
      PJ=SAT*100.
C U REPRESENTS SPECIFIED ENERGY EXPENDITURE FROM 'METABOLIC RATE'
C AS SPECIFIED BY THE OPERATOR - CHANGING C7. IN ST.NO 490 1ST TERM IS
C O2 CONSUMPTION OF RESP. MUSCLES, AND 2ND O2 CONS. OF HEART.  IN
C THE EVENT OF ANAEROBIC METAB., SAME ENERGY REQUIREMENTS
C INVOLVE 11X NO OF MOLES OF LACTATE BEING PRODUCED
C WITH OXYGEN BEING SPARED (XLACT)
  490 U=FT*(ABS(SVENT)**C4*C5+COADJ+C7)
C COMPUTE NEW TISSUE GAS AMOUNTS(T-2MT)
  500 TO2MT=TO2MT+FTCOC*(EO2CT-TO2CT)-U+XLACT
C SET LIMITS TO PREVENT ARITH.ERRORS
      if(TO2MT-E) 940,940,510
C COMPUTE TISS. PO2, DAMPING APPROPRIATELY
  510 TO2PR=DAMP(TO2MT*C31,TO2PR,C55)
      X=TO2MT-250.
      if(X) 530,530,520
C NEXT SECTION CONCERNS LACTIC ACID METABOLISM
  520 TO2PR=45.+.09*X
C LOCAL VARIABLE Y WILL BE USED LATER FOR CATABOLISM RELATED
C TO CARDIAC OUTPUT AND METABOLISM
  530 Y=RLACT*C29
C Z=CATABOLIC RATE FOR LACTATE
C X IS THRESHOLD - WHEN TPH LESS THAN 7.0 CATABOLISM IMPAIRED
C CEREB.BL.FLOW(CBF) IS USED TO GIVE APPROPRIATE CHANGES IN LACTATE
C METAB. WITH LOW PCO2 OR ALKALOSIS. (CBF COMPUTED ELSEWHERE
C AND HAPPENS TO CHANGE IN THE APPROPRIATE WAY)
      W=CBF*.019
      if(W-1.) 536,536,534
  534 W=1.
  536 X=TPH*10.-69.
      if(X-W) 550,550,540
  540 X=W
C 1ST TERM IS HEPATIC REMOVAL, 2ND IS RENAL REMOVAL WITH PH INFLUENCE
C 3RD TERM IS BLOOD FLOW RELATED METABOLISM BY MUSCLES, MADE
C DEPENDENT ON CARDIAC OUTPUT (COADJ).  WHOLE EXPRESSION IS
C MULTIPLIED BY Y, A FUNCTION OF BLOOD LACTATE CONCENTRAION
C+++++++++++++++++++++++++++++++++++++++++++++++++
C
C LACTATE CATABOLISM SPLIT INTO ORGANS AND MUSCLE CATABOLISM
C (CATLIVER AND CATCIDNEY) AND CATMUS
  550 CATLIV=Y*(X*.8612)
      CATCID=Y*(.0232*2**((8.-TPH)*3.33))
      ORGCAT=CATCID+CATLIV
C     CATCID=CATCID/FT
C     CATLIV=CATLIV/FT
      X=ORGCAT-.3*FT/.016667
      if(X.GT.0.0) ORGCAT=.3000*FT/.016667
      X=QA/FT
      CALL FUNCTN (X,CATOX,FUN2,10)
C  CATOX IS A CATABOLISM-OXYGEN CONSUMPTION RELATION
      CATMUS=Y*CATOX
      Z=ORGCAT+CATMUS
       CATMUS=CATMUS/FT
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++
      W=C70/(W+.3)
C     AFBR1=Z/FT
C FITNS IS THRESHOLD FOR SWITCH TO ANAEROBIC METABOLISM
C RELATED TO FITNESS
C-------- ALTERS THRESHOLD FOR ANAEROBIC METAB.SWITCH, AT REST ONLY
      V=C73-TO2PR
C........
      if(V) 570,570,560
C NEXT STATEMENT PROVIDES VIRTUAL TRIGGER EFFECT AND
C RAPIDLY INCREASES LACTIC ACID PROD.ifTISS. PO2 LOW
  560 W=W+C42*(V+1.)**4
C CATABOLISM(Z) FALLS ifTISS. PO2 TOO LOW
C++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
      if(TO2PR.LT.(FITNS-8.0)) Z=Z*TO2PR*.04
      if(Z.GT.0.85) Z=0.85
C
C++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C XLACT IS O2 SPARING EFFECT OF LACTIC ACID PRODUCTION
C (NOT ALLOWED TO EXCEED ACTUAL O2 CONSUMPTION)
  570 X=2.04*(W-C32)
      if(X-U) 590,590,580
  580 X=U
  590 XLACT=DAMP(X,XLACT,C53)
C LIMIT OF RATE OF LACTATE FORM DETERMINED BY METAB. DRIVE
C TO TISSUES (I.E. LEVEL OF EXERCISE),  AND TO BODY SIZE
      if(W-C40) 610,610,600
  600 W=C40
C REDUCE LACTATE CATABOLISM ifCARD.OUTPUT LESS THAN 1/3 NORMAL
C TO TAKE ACCOUNT OF PROBABLE DIM.LIVER AND KIDNEY BL.FLOWS
  610 X=C24-COADJ
      if(X) 630,630,620
  620 Z=Z*COADJ/C24
C INCR.TOTAL LACTIC ACID BY DIFFER.BETWEEN PROD. AND CATABOLISM
  630 V=W-Z
C     AFBR2=Z/FT
C     PROD=W/FT
      TLAMT=TLAMT+V
      RLACT=DAMP(TLAMT*C15,RLACT,COADJ*C55)
C NEXT IS FOR NITROGEN STORES IN TISSUES
C MOVE N2 BETWEEN FAST(T) AND SLOW(S) TISSUE COMPARTMENTS
C ACCORDING TO P.PRESS. DIFFS.
  640 X=(TN2PR-SN2PR)*C60
      TN2MT=TN2MT+FTCOC*(EN2CT-TN2PR*.00127)-X
      SN2MT=SN2MT+X
C TEST ifSLOW SPACE SUPERSATURATED
      Y=(SN2MT*C26-C11)*C27
      if(Y) 650,650,660
C ifSO, AUGMENT U AND DECREMENT S, OR VICE VERSA IF
C AMBIENT PRESSURE RELATIVELY HIGHER
  650 Y=Y*.3
      if(UN2MT) 670,670,660
  660 SN2MT=SN2MT-Y
C BUBBL IS ARBIT.INDEX OF BUBBLE SYMPTS,TAKING INTO ACCOUNT
C BTPS VOLUME AND LOADING BY NUMBER OF MOLECULES OF GAS
C+++ N.B. 'BUBBL' IS ONLY A ROUGH INDEX - PROGRAMME UNDER DEVELOPMENT
      BUBBL=UN2MT**1.2*C23
      UN2MT=UN2MT+Y
C COMPUTE PARTIAL PRESSURES
  670 SN2PR=SN2MT*C26
      TN2PR=TN2MT*C28
C++++++++++++++++ RELATION BETWEEN TRQ AND OXYGEN CONSUMPTION
      X=QA/FT
      CALL FUNCTN (X,TRQ,FUN1,5)
C
C+++++++++++++++++++
C TISS. CO2 EXCHANGES; U=METAB.; .001 CONVERTS CC TO LITRES
      TC2MT=TC2MT+(FTCOC*(EC2CT-TC2CT)+TRQ*U)*.001
C COMPUTE PART.PRESS. FROM TOTAL CO2 AND STAND. BICARB.
      TC2PR=(TC2MT*C30-TC3MT*C36+C33)*C43
C FY STORES CHANGE IN TISS. CO2 FOR ADJUSTING TISS/. HCO3 BUFFERS
      FY=TC2PR-TC2RF
      TC2RF=TC2PR
C .4 IN LINE BELOW REPRESENTS BUFFERS OF LACTIC ACID PARTLY INSIDE
C CELLS, SO THAT THE DISPLACEMENT OF BICARBONATE IS LESS
C THAN STRICT MOLAR EQUIVALENCE
C BUFFERING EFFECT OF BICARBONATE RAISED:
C+++++++++++++++++++++++++++++++++++++++++++++++++++
C
      TC3MT=TC3MT+FTCOC*.1*(VC3MT*C1-TC3MT*C13)-1.0*V
C
C++++++++++++++++++++++++++++++++++++++++++++++++++++
      Y=(TC2PR-40.)*C3
  690 TC3CT=TC3MT*C13+Y
      if(TC3CT) 940,940,700
  700 TPH=PHFNC(TC3CT,TC2PR)
      CALL GASES (TO2PR,TC2PR,TO2CT,TC2CT,TPH,SAT)
C AMTS OF GASES IN VENOUS POOL INC.BY ARRIVING BLOOD FROM
C TISSUES AND DECREMENTED BY BLOOD GOING TO LUNGS. SAME FOR
C BICARBONATE. CONTENTS V-2CT THEN DETERMINED
      X=C69*COADJ*FTCO
      VC2MT=VC2MT+FTCOC*TC2CT-FTCO*(VC2CT*C14-RC2CT*SHUNT)+X*EC2CT
      VO2MT=VO2MT+FTCOC*TO2CT-FTCO*(VO2CT*C14-RO2CT*SHUNT)+X*EO2CT
      VC3MT=VC3MT+FTCOC*.1*(TC3MT*C13-VC3MT*C1)+ADDC3
      X=TC3AJ*C10
      TC3AJ=TC3AJ-ADDC3+V-X
      TC3MT=TC3MT-FY*C64+X*.67
      VO2CT=VO2MT*C2
      VC2CT=VC2MT*C2
C*** LOCAL ARRANGEMENTS
C+++ S/R DELAY CAN BE OMITTED WITH LOSS OF ACCURACY ONLY
C+++ WHEN USING SHORT ITERATION INTERVALS
      CALL DELAY
      VC3CT=VC3MT*C1+Y
      if(VC3CT) 940,940,710
  710 VPH=PHFNC(VC3CT,TC2PR)
      GO TO 740
C THIS  SECTION - RARELY NEEDED - IS FOR DIFFUSION RESPIRATION
  720 FD=XVENT*C12
      AO2MT=AO2MT-FD*FIO2
      AC2MT=AC2MT-FD*FIC2
      AN2MT=AN2MT-FD*Z
      GO TO 850
C PREVENT LATER DIVISION ERRORS ifGAS EXCHANGE ZERO
  730 QA=.001
      QB=E
      GO TO 840
C NEXT LONG SECTION CONCERNS GAS EXCH.IN LUNGS.PC IS FRACTION OF
C CARD.OUTPUT PERFECTLY MIXED WITH ALVE0LAR GASES.U AND V=AMTS OF
C EACH GAS TAKEN IN PER UNIT FRACT TIME(FT)
  740 PC=FTCO*C14*PC
      X=AVENT*C12
      U=X*FIO2
      V=X*FIC2
C NEXT 3 STS.COMPUTE NEW AMTS.OF EACH GAS IN LUNGS. W IS VOLUME
C AT END OF NOMINAL 'INSPIRATION'
      AO2MT=AO2MT+U
      AC2MT=AC2MT+V
      Z=100.-FIO2-FIC2
C-------- ECONOMISES
      AN2MT=AN2MT+X*Z
C........
      W=AO2MT+AC2MT+AN2MT
C NOW CALC.ALVEOLAR PARTIAL PRESSURES
      X=C11/W
      PO2=AO2MT*X
      PC2=AC2MT*X
C CHANGE ALV.GAS AMTS.IN ACCORDANCE WITH BLOOD GAS CONTENTS
C ENTERING(V-2CT) AND LEAVING(P-2CT) THE LUNGS.
C PC=FINAL NEW AMT OF TOTAL GAS AT END OF ALL
      AO2MT=AO2MT+PC*(VO2CT-PO2CT)
      AC2MT=AC2MT+PC*(VC2CT-PC2CT)
      AN2MT=AN2MT+PC*(TN2PR*.00127-EN2CT)
      PC=AO2MT+AC2MT+AN2MT
C FY BECOMES + ONLY ifMORE GAS GOES OUT THAN IN, IN WHICH CASE FY
C IS LATER BROUGHT INTO THE CALCULATION OF EFFECTIVE DEAD SPACE
      if(PL-2.) 750,770,750
  750 if(AVENT-20.) 770,760,760
  760 FY=(PC-W)*C34/RRATE
      GO TO 780
  770 FY=0.
  780 if(PL) 790,800,800
  790 CALL BAGER (5,PC,X,C12,SIMLT)
C XVENT IS VOL.EXHALED IN NOM.TIME (FT) DOWN TO RESTING LUNG VOL.
C ifTHIS IS NEG.THERE IS SOME DIFFUSION RESP.IN WHICH CASE GO BACK
  800 XVENT=PC*C35-VLUNG
      if(XVENT) 720,810,810
C+++++++++++++++++++++++++++++++++++++++++++++++++++
CHANGE  TO LET PC2PR OBEY RESPIRATORY FORMULA
C NOW DR. DICKINSONS VERSION USED
C--------- IMPROVES COMPUTED EXPIRED GAS QUANTITIES
  810 X=XVENT*C25
      DVENT=X/PC
      X=X/C11
      Y=X*AO2PR
      Z=X*AC2PR
      PC=X*(C11-AO2PR-AC2PR)
C...........
C+++++++++++++++++++++++++++++++++++++++++++++++++++
C U=O2, V=CO2 UPTAKE IN FT TIME, Y,Z,PC=GAS OUTPUTS
C ALGEBRAIC SUMMING OF INTAKE AND OUTPUT OF O2 AND CO2
      QA=U-Y
      QB=Z-V
      if(PL-.5) 830,830,820
  820 CALL BAGER (4,XVENT,DVENT,C12,SIMLT)
      if(DVENT+9000.) 940,830,830
  830 if(AVENT-E) 730,730,840
C SET NEW AMTS.OF EACH GAS, THEN CAL.PARTIAL PRESSURES
  840 AO2MT=AO2MT-Y
      AC2MT=AC2MT-Z
      AN2MT=AN2MT-PC
  850 U=C11/(AO2MT+AN2MT+AC2MT)
C TAKE ACCOUNT OF INSP/EXP DURATION RATIO
      V=C37/RRATE
      if(V-4.) 870,870,860
  860 V=4.
  870 if(AVENT-20.) 880,890,890
  880 V=0.
C SPEED OF CHANGE OF ALV. GAS TENSIONS(X)= FUNCT. OF TIDAL VOL.
  890 X=(TIDVL+100.)*C38
C COMPUTE END-'EXPIRATORY' PARTIAL PRESSURES
      Y=AO2MT*U
      Z=AC2MT*U
C DAMP FUNCTION USED TO PREVENT OSCILLATORY SWINGS
C OF ALVEOLAR GAS PRESSURES
      AO2PR=DAMP((Y+(PO2-Y)*V),AO2PR,X)
      AC2PR=DAMP((Z+(PC2-Z)*V),AC2PR,X)
      if(AO2PR-E) 940,940,900
  900 if(AC2PR-E) 940,940,910
C DETERM.EXPIRED RQ(PC)THEN ALV.GAS TENSIONS, AND EVENTUALLY
C CONTENTS OF CO2 + O2 IN PULM.CAP.BLOOD(P-2CT)
  910 if(QA) 920,930,920
  920 PC=QB/QA
  930 X=VC3MT*C1+C3*(AC2PR-40.)
      if(X-E) 940,950,950
  940 LL5=-1
      GO TO 1455
  950 Y=PHFNC(X,AC2PR)
      CALL GASES (AO2PR,AC2PR,PO2CT,PC2CT,Y,SAT)
C NEXT DETERMINES CEREBRAL BLOOD FLOW ADJUSTMENTS IN
C RELATION TO CARDIAC OUTPUT AND BRAIN PH(PCO2 SENSITIVE)
      Z=SQRT(COADJ)*.5
      if(Z-1.) 970,970,960
  960 Z=1.
  970 Y=(7.4-BPH)*(BC2PR*.0184-BC3AJ*.1)
      if(Y) 990,990,980
  980 Y=300.*Y**2
  990 if(Y-4.4) 1010,1010,1000
 1000 Y=4.4
 1010 CBF=DAMP((Y-.12)*42.5*Z,CBF*Z,C55)
C COMP.BRAIN GAS AMTS.BY METAB.ASSUMING RQ OF .98 AND
C ALLOWING FOR DIFFERENT AMTS.SUPPLIED IN ART.BLOOD AND
C LEAVING IN VENOUS BLOOD. CHECK FOR ARITH.ERRORS
C THEN CALC. BRAIN GAS TENSIONS FROM GUESTIMATED DISSOC. CURVES
      Y=CBF*C39
      X=C41*(BO2AD+.25)
      Z=X
      if(BO2PR-18.) 1020,1020,1040
 1020 Z=X*(BO2PR*.11-1.)
      X=X*(19.-BO2PR)
      if(Z) 1030,1040,1040
 1030 Z=0.
 1040 BO2MT=BO2MT+Y*(RO2CT-BO2CT)-2.*Z*(BO2AD+.1)
      if(BO2MT) 1050,1050,1060
 1050 BO2MT=.1
 1060 BC2MT=BC2MT+Y*(RC2CT-BC2CT)+2.15*X
      BO2PR=BO2MT*1.6
      BC2PR=BC2MT*.078
      W=BC2PR-40.
      Y=BC3CT+BC3AJ+.2*W
C A SMALL PROPORTION OF ADDED BICARBONATE IS ADDED ALSO
C TO CSF, THUS AFFECTING BREATHING APPROPRIATELY
      BC3AJ=BC3AJ+((RC3CT-24.)*.3-BC3AJ)*C42
C ADJ.BICARB.TO PCO2 THEN CALC.'BRAIN PH'IE.PH AT
C RECEPTOR. THEN PROCEED TO DETERMINE CONTENTS OF O2
C AND CO2 IN BLOOD LEAVING BRAIN
      X=PHFNC(2.*Y+RC3CT,2.*BC2PR+RC2PR)
      Z=((ABS(X-BPH)+E)*100.)**2+.04
      if(Z-C17) 1080,1080,1070
 1070 Z=C17
C RESTRICT RATE OF CHANGE OF BRAIN RECEPTOR PH
 1080 BPH=DAMP(X,BPH,Z)
      Z=PHFNC(VC3MT*C1+(BC2PR-40.)*C3,BC2PR)
      CALL GASES (BO2PR,BC2PR,BO2CT,BC2CT,Z,SAT)
C NOW FOLLOW VENTILATION CALCULATIONS, STARTING WITH
C NARTI=0 WHICH IS ARTIFICIAL VENT.  COMPUTE TOTAL DEAD
C SPACE, ANAT + PHYSIOL., THEN ALV.VENT.(AVENT)
      if(NARTI) 1090,1090,1100
 1090 DVENT=C51
C NAT.VENT.CONTROLS. TOTL.VENT(U AND SVENT)=SUM OF CENTRAL CO2(PH)
C CHEMORECEPTOR DRIVE(SLOPE X,INTERCEPT Z)  O2 LACK
C RECEPTOR(SLOPE Y)  CENTRAL NEUROGENIC DRIVE(PROPNL. TO
C O2 CONSUMPTION C7, + CONSTANT ETC.). AZ ETC. ARE
C FOR MANUAL ADJUSTMENTS OF VENTILATORY CONTROLS
 1100 Y=(118.-PJ)*.05
      Z=Y*.002
      X=(C65+Z-BPH)*1000.*Y
      if(X) 1110,1120,1120
 1110 X=0.
 1120 W=(C66+Z-BPH)*150.*Y
C HIGH BRAIN PH OR LOW PCO2 ONLY INHIBITS VENT.ifLEARNT
C INTRINSIC DRIVE (CZ) IS REDUCED OR ABSENT
      if(W) 1130,1150,1150
 1130 if(C67) 1150,1150,1140
 1140 W=0.
 1150 Z=(BC2PR-120.)*.25
      if(Z) 1160,1170,1170
 1160 Z=0.
 1170 Y=(98.-PJ)*(RC2PR-25.)*.12
      if(Y) 1180,1190,1190
 1180 Y=0.
C BO2AD IS INDEX OF BRAIN OXYGENATION ADEQUACY
C AND LOWERS AND EVENTUALLY STOPS BREATHING ifTOO LOW
C-------- CHANGE IN BRAIN HYPOXIA THRESHOLD DESIGNATION
 1190 U=BO2MT-10.
C........
      if(U) 1210,1200,1200
 1200 U=1.
      GO TO 1220
 1210 U=0.
 1220 BO2AD=DAMP(U,BO2AD,C63)
C PREVENT IMMEDIATE CHANGES IN SPECIFIED VENT. CAPACITY
      XRESP=DAMP(C46,XRESP,C68)
C COMPUTE TOTAL ADDITIVE EFFECTS OF VENT. STIMULI
      U=(C44*(X+W)+C45*Y+XRESP-Z)*C47
C RESTRICT TO MAX. VALUE, PREDICTED OR ASSUMED
      if(U-C6) 1240,1240,1230
 1230 U=C6
C DAMP SPEED OF RESPONSE ACCORDING TO CARD.OUTPUT AND DEPTH
C OF BREATHING, INCLD. BRAIN OXYGENATION INDEX
 1240 X=(COADJ+5.)*C62/(TIDVL+400.)
      SVENT=BO2AD*DAMP(U,SVENT,X)
      if(PL) 1280,1250,1250
C ifVENT. STIMULI INADEQUATE, =APNOEA
 1250 if(SVENT-C48) 1260,1260,1290
 1260 if(NARTI) 1290,1290,1280
 1280 DVENT=E
      RRATE=.0001
      GO TO 1350
C RESP.RATE CALC.FROM CONSTANT + ELASTANCE +TOTAL VENTN.+ART PO2
C ALLOWING FOR MANUAL ADJUSTMT.OF BREATHING CAP(PR)
 1290 if(NARTI) 1320,1320,1300
 1300 DVENT=SVENT
      RRATE=(C49+DVENT**.865*.370)*C50/(PJ+40.)
      if(RRATE-1.) 1350,1350,1310
 1310 if(COADJ-.5) 1350,1350,1320
C CALC DYNAMIC DEAD SPACE AS SUM OF ANAT.FACTORS + THOSE
C DEPENDENT ON VENTN. AND PERFUSION, THEN CALC.ALV.VENTN.
 1320 U=AO2PR*.15
      if(U-70.) 1340,1340,1330
 1330 U=70.
 1340 DSPAC=DAMP((C52+DVENT*100./RRATE**1.12+20.*DVENT/(COADJ+
     X5.)+U+FY+C54*(TIDVL+500.)),DSPAC,C55)
 1350 TIDVL=DVENT*1000./RRATE
 1360 AVENT=(TIDVL-DSPAC)*RRATE*FT
C RESTRICT TIDAL VOL. TO MAXIMUM(C20), THEN ifNECESSARY GO
C BACK TO RECOMPUTE RESP. RATE, PROVIDING ARTIF.VENT. NOT IN USE
      if(NARTI) 1380,1380,1365
 1365 X=TIDVL-C20
      if(X) 1380,1380,1370
 1370 TIDVL=C20
      RRATE=DVENT*1000./TIDVL
      GO TO 1360
 1380 if(AVENT) 1390,1390,1400
 1390 AVENT=E
 1400 FVENT=AVENT*C56
C TND,J3,ND CONCERNED WITH TIMING MARKS. PG IS INDEX OF TIME
C BRAIN HAS BEEN DEPRIVED OF OXYGEN.  ifTOO GREAT DEATH RESULTS
      TND=TND+C57
      if(BO2AD-.3) 1410,1410,1420
 1410 PG=PG-(BO2AD-1.)*C58
      GO TO 1430
 1420 PG=PG-BO2AD*C59
 1430 if(TND-60.) 1450,1440,1440
 1440 TND=TND-60.
      J3=J3+1
 1450 ND=INT(TND)
C TEST FOR DEATH, OR GIVE ERROR MESSAGE ifLL5 = -1
 1455 CALL DEATH (LL1,LL5)
      if(LL1-2) 1457,1600,1600
C OUTPUT SUPPRESSION INSTRUCTIONS
 1457 if(NB-1) 1470,1590,1460
 1460 if(MORAN-NREPT) 1590,1500,1590
 1470 if(ISPAR-2) 1500,1480,1490
C-------- PREVENTS TIME SCALE ERRORS AFTER BACKTRACK
 1480 if(LL4-6) 1590,1500,1500
 1490 if(LL4-30) 1590,1500,1500
C........
C RESET LOOP COUNTER
 1500 LL4=0
C CHOOSE TYPE OF DISPLAY
C------- NPRT=0 SUPRESSES THE PRINTOUT
      if(NPRT) 1590,1590,1505
 1505 if(NC-3) 1510,1515,1515
C..........
 1510 CALL BRETH
      GO TO 1590
C CONVERT ALL PRESSURES IN MM HG TO SI UNITS ifPREVIOUSLY SPECIFIED
C BEFORE OUTPUT
 1515 CALL UNITS(1,SIMLT)
      IF(NC-3) 1540,1540,1520
 1520 WRITE (KL,1530) T
 1530 format(1X,10F7.2)
      GO TO 1580
 1540 DO 1550 J=1,8
      JOKE=NE(J)
 1550 TJJ(J)=T(JOKE)
      WRITE (KL,1560) J3,ND,(TJJ(J),J=1,8)
 1560 format(1X,I3,1H.,I2,2F8.3,6F8.1)
C CONVERT ALL PRESSURE UNITS BACK TO MM HG BEFORE GOING ON
 1580 CALL UNITS(2,SIMLT)
 1590 CONTINUE
C RESET BICARBONATE ADDITION INDEX TO ZERO
      ADDC3=0.
C ENTER SR.DEADY TO ALLOW MANUAL CHANGES OF VARIABLES
 1600 CALL UNITS (1,SIMLT)
C-------- DELETES LL2, LL1=-9999 SIGNALS END OF PROGRAM FROM DEADY
      CALL DEADY (LL1,LL4,LL5,NREPT,SIMLT)
C
C+++++++++++++++++++++++++++++++++++++++++++++
C
C   STOPS PROGRAM IN CASE OF 'I CAN'T GO ON'
C     if(TPH-7.080) 1630,1605,1605
C
C+++++++++++++++++++++++++++++++++++++++++++++
C1605 CONTINUE
      if(LL1.EQ.-9999) GOTO 1620
C........
C RESET UNITS TO MM HG
      CALL UNITS(2,SIMLT)
      NREPT=NA
 1610 if(LL1-1) 190,190,170
C------- END OF PROGRAM MESSAGES REMOVED FROM S/R DEADY (TO SIMPLIFY
C        USE OF MACPUF WITH THE TEXT DRIVER 'MACAID'
 1620 if(MCAID) 1630,1630,1650
C
C+++++++++++++++++++++++++++++++++++++++++++
C
C THE FOLLOWING PART IS INTRODUCED TO CALCULATE A PERFORMANCE INDEX
C COMPARING MACPUF RESULTS (ON INCAR) WITH EXPERIMENTAL DATA (ON
C DATAF) WITH THE FORMULA:
C
C     [ 1-( INTEGRAL (ERROR)**2 DT /INTEGRAL (DATAF)**2 DT ]*100
C
C1630 WRITE (KT,1633)
C1633 format(' DO YOU WANT TO CALCULATE THE PERFORMANCE INDEX?',/,
C    X' 1=YES, 2=NO ',/)
C     CALL NXTWD (7,XXX,I,1,2)
C     GO TO (1635,1638),I
C1635 REWIND KDATF
C     REWIND KPLOT
C     NTIME=J3
C     DO 1710 I=1,NTIME
C     READ (KPLOT,1700) OARS(I,1),OARS(I,2),OARS(I,3),OARS(I,4),
CC   X OARS(I,5),OARS(I,6),OARS(I,7),OARS(I,8)
C1700 format(F6.2,F4.1,2F6.0,F5.1,F4.1,F5.2,F5.1)
C1710 CONTINUE
C     DO 1730 I=11,NTIME
C     READ (KDATF,1720) QARS(I,1),QARS(I,2),QARS(I,3),QARS(I,4),
C    X QARS(I,5),QARS(I,6),QARS(I,7),QARS(I,8)
C1720 format(F6.2,F4.1,2F6.0,F5.1,F4.1,F5.2,F5.1)
C1730 CONTINUE
C
C     CALL PERFO(PI,NTIME,QARS,OARS)
C
C     WRITE (KPLOT,1740) PI(2),PI(3),PI(4),PI(5),PI(6),PI(7),PI(8)
C     WRITE (KT,1740) PI(2),PI(3),PI(4),PI(5),PI(6),PI(7),PI(8)
C1740 format(1X,' PERFORMANCE INDEX FOR:',/,' LACTATE=',F5.1,/,
C    X ' VO2=',F5.1,/,' VCO2=',F5.1,/,' VE=',F5.1,/,'AF=',F5.1,/,
C    X ' RQ=',F5.1,/,' CAOUT=',F5.1,/,' ALL IN PER CENT',/)
 1630  CONTINUE
 1638 WRITE (KT,1640)
C*** LOCAL ARRANGEMENTS
 1640 format(' THANK YOU FOR YOUR INTEREST. PLEASE LET ',
     X'YOUR TUTOR',
     X/,' HAVE ANY COMMENTS, SUGGESTIONS OR CRITICISMS')
      STOP
 1650 RETURN
C.......
      END
      BLOCKDATA
      DIMENSION FUN3(20)
        COMMON /PLOT/ KPLOT,KDATF,WRATE,EFFIC,FUN3
C++++++++++++++++++++++++++++++++++++++++++++++++
C      DATASETS FOR SUBROUTINE FUNCTION
C      FUN1 FOR TISSUE RESPIRATORY QUOTIENT
C      FUN2 FOR MUSCLE LACTATE CATABOLISM
C      FUN3 FOR WORK RATE-EFFICIENCY RELATION
C
      DATA FUN3(1), FUN3(2), FUN3(3), FUN3(4), FUN3(5), FUN3(6),
     X FUN3(7), FUN3(8), FUN3(9), FUN3(10), FUN3(11), FUN3(12),
     X FUN3(13), FUN3(14), FUN3(15), FUN3(16), FUN3(17), FUN3(18),
     X FUN3(19),FUN3(20) /3.,2.,15.,6.7,30.,11.5,45.,14.5,75.,18.,
     X 90.,19.3,120.,20.7,150.,20.9,225.,22.5,300.,20.5/
C
C++++++++++++++++++++++++++++++++++++++++++++++++++++++
      END
C
C*****************************************************************
C
      SUBROUTINE BAGER (N,CA,CB,CC,SIMLT)
C THIS DEALS WITH BAG REBREATHING ETC
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,NW
        COMMON NFLAG,J3,ISPAR,NA,NB,NC,ND,NE(8)
        COMMON NARTI,MT,K2,K4,INDEX
C COMMON ARRAY USES T1,T2 ETC. IN MANY SUBROUTINES TO SAVE UNUSED LISTS
C OF NAMED VARIABLES
        COMMON FIO2,FIC2,T1(4),VLUNG,T2(5),BARPR,TEMP,T3(22),BAGO,BAGC,
     X AO2MT,AC2MT,T4(6),TIDVL,RRATE,T5(21),DSPAC,REFLV,T6(7),QB,
     X PW,FT,T7(17),AVENT,PL,T8(12),QA,T9(2),BAG
      GO TO (100,430,430,440,500,510,230), N
  100 if(NW2.GT.19) GO TO 120
      WRITE (KT,110)
  110 format(' DO YOU WANT TO MAKE YOUR SUBJECT',/,' 1.CLOSE THE GLOTTI
     XS,   2.COLLECT EXPIRED AIR IN A BAG,',/,' 3.REBREATHE FROM A BAG,
     X  4.SAME, WITH CO2 ABSORBER ATTACHED,',/,' 5.RESTORE STATUS QUO -
     XBREATHING AIR, GLOTTIS OPEN, NO BAG')
      NW2=0
  120 CALL NXTWD (7,XXX,NNN,1,5)
C INDEX PL CODES BAGER CALLS FROM MAIN PROGRAMME
      PL=0.
      GO TO (410,150,140,130,170), NNN
  130 PL=PL+1.
  140 PL=PL+1.
  150 PL=PL+1.
      if(NNN-2) 160,160,200
C COLLECTION OF EXPIRED AIR INTO EMPTY BAG
  160 BAG=.00001
      BAGO=.0000001
      GO TO 300
C RESTORE ALL TO NORMAL. BAG STAYS FILLED AS IT WAS LEFT.
  170 VLUNG=REFLV
      FIO2=20.93
      FIC2=0.03
      WRITE (KL,180)
  180 format(' *** GLOTTIS OPEN - BAG DISCONNECTED - BREATHING AIR')
  190 RETURN
C BAG REBREATHING OPTIONS
  200 if(NW2.GT.19) GO TO 220
      NW2=0
      WRITE (KT,210)
  210 format(' DO YOU WANT..1. 100: O2, 2. A GAS MIXTURE, 3. TO GO ON W
     XITH PREVIOUS BAG')
  220 CALL NXTWD (7,XXX,NNNN,1,3)
C SET BTPS/STPD CORRECTION FACTORS
  230 X=BARPR/SIMLT-1.2703*TEMP
      CORR=(273.+TEMP)/(X*.3592)
      if(N-7) 240,530,240
  240 if(NNNN-3) 250,390,250
  250 if(NW2.GT.19) GO TO 280
      NW2=0
  260 WRITE (KT,270)
  270 format(' GIVE INITIAL GAS VOLUME IN BAG, IN CC (BTPS)')
  280 CALL NXTWD (7,BAG,NN,300,30000)
      if(NNNN-2) 290,310,390
  290 BAGO=BAG/CORR
  300 BAGC=.0000001
      GO TO 390
  310 if(NW2.GT.19) GO TO 330
      NW2=0
      WRITE (KT,320)
  320 format(' SPECIFY PERCENT CO2')
  330 CALL NXTWD (7,BAGC,NNN,0,100)
      if(NW2.GT.19) GO TO 350
      NW2=0
      WRITE (KT,340)
  340 format(' NOW PERCENT OXYGEN')
  350 CALL NXTWD (7,BAGO,NNN,0,100)
      X=BAGO+BAGC
      if(X-100.) 380,380,360
  360 WRITE (KT,370)
  370 format(' RIDICULOUS - TRY AGAIN')
      GO TO 310
  380 X=BAG*.01/CORR
      BAGO=BAGO*X
      BAGC=BAGC*X
C++++++++++REPEAT TWO STATEMENTS TO INITIALIZE CORR
  390 X=BARPR/SIMLT-1.2703*TEMP
      CORR=(273.+TEMP)/(X*.3592)
      X=CORR*100./BAG
C++++++++++++++++++++++++++++++++++++++++++++++++++
      XXX=BAGO*X
      X=BAGC*X
      WRITE(KL,400) BAG,XXX,X
  400 FORMAT(' ***',F7.0,'CC BAG CONNECTED, CONTAINING',F6.1,': O2 + ',F
     X5.1,': CO2')
      RETURN
C GLOTTIS CLOSED; STORE INITIAL LUNG VOLUME FOR REFERENCE
  410 WRITE (KL,420)
  420 format(' *** GLOTTIS CLOSED UNTIL FACTOR 100 CHANGED AGAIN')
      REFLV=VLUNG
      PL=-1.
      RETURN
C SET INSPIRED GASES EQUAL TO MIXTURE IN THE BAG
  430 X=1./(BAG*CC+.00001)
      FIO2=BAGO*X
      FIC2=BAGC*X
      if(PL.GT.2.5) FIC2=0.
      RETURN
C DSPVT IS GAS IN UPPER AIRWAY BREATHED OUT INTO BAG
  440 if(PL.GT.1.) GO TO 450
C+++ NEXT SECTION FOR BAG COLLECTION ONLY
      X=DSPAC*RRATE*FT
      BAG=BAG+CA+X
      X=X*CC
      BAGO=BAGO+CB*AO2MT+FIO2*X
      BAGC=BAGC+CB*AC2MT+FIC2*X
      RETURN
C TEST ifTIDAL VOL. GT. THAN BAG VOLUME; ifSO CODE EXIT FROM MAIN PROG
  450 if(BAG.GT.TIDVL) GO TO 470
      WRITE (KL,460)
  460 FORMAT(' *** TIDAL VOL. TOO BIG FOR BAG')
      CB=-10000.
      RETURN
  470 if(PL.LT.2.5) GO TO 480
      BAG=BAG-AC2MT*.01/CC
      BAGC=0.
      GO TO 490
C THIS ST. SKIPPED ifCO2 ABSORBER IN CIRCUIT
  480 BAGC=BAGC+QB
  490 BAGO=BAGO-QA
      BAG=BAG-AVENT+CA
      RETURN
  500 VLUNG=CA*.01/CC
      RETURN
  510 WRITE (KT,520) VLUNG
  520 format(' LUNG VOLUME=',F6.0,' CC(BTPS)')
      RETURN
C DISPLAY SECTION FOR 'INSPECT' TABLE IN S/R DEADY
  530 if(BAG.LT..001) BAG=.001
      X=X*(273.+TEMP)/(273.*BAG)
      BAGP=BAGC*X*SIMLT
      BAGPO=BAGO*X*SIMLT
      XNMT=BAG/CORR-BAGO-BAGC
      WRITE (KL,540) BAGPO,BAGP,BAGO,BAGC,XNMT,BAG
  540 format(' ***** BAG.',F7.1,F8.1,16X,F8.0,F8.0,'  *N2=',F7.0,/,' *
     XBAG VOL.',F7.0,' (BTPS)')
      RETURN
      END
C
C*****************************************************************
C
      SUBROUTINE BRETH
C THIS DOES GRAPHICAL OUTPUT OF TOTAL VENT.(DVENT IN MAIN
C PROGRAMME),RESP.RATE(RRATE),ARTERIAL PCO2(RC2PR) AND
C ARTERIAL PO2(RO2PR). T1,T2 ETC. USED AS IN S/R BAGER
        INTEGER DOT(1),BLANK(1),C(1),O(1),F(1),V(1),X(1),XLINE(65)
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,NW
        COMMON NFLAG,J3,ISPAR,NA,NB,NC,ND,NE(8)
        COMMON NARTI,MT,K2,K4,INDEX
        COMMON T1(47),RRATE,T2(2),DVENT,T3(20),RO2PR,T4,RC2PR
     X ,T5(8),BUBBL
        DATA DOT,BLANK,C,O,F,V,X/1H.,1H ,1HC,1HO,1HF,1HV,1H*/
      IOK(I)=(I-1)*(65-I)
C-------- AVOIDS INTEGER OVERFLOW WITH VERY HIGH PO2 VALUES
C*** LOCAL ARRANGEMENTS
      IFUNC(Z)=INT(AMIN1((Z*.5+1.1),80.))
C ifTHE COMPUTER CAN HANDLE INTEGERS GREATER THAN 32000, THEN THE
C ABOVE FUNCTION CAN BE REPLACED BY THE FOLLOWING SIMPLER FUNCTION
C (SOME MANOEUVRES MAY MAKE ART. PO2 TRANSIENTLY VERY HIGH)
C     IFUNC(Z)=INT(Z*.5+1.1)
C........
      KD=IFUNC(RO2PR)
      KK=IFUNC(RC2PR)
      KR=IFUNC(RRATE)
      KH=IFUNC(DVENT)
      KN=IFUNC(BUBBL)-1
      DO 100 K=1,65
  100 XLINE(K)=BLANK(1)
      XLINE(1)=DOT(1)
C-------- WITH MAX0 FUNCTION BELOW, PREVENTS USELESS CURSOR MOVEMENT
C NEXT STATEMENT STOPS CURSOR MOVING WHOLE WIDTH OF
C DISPLAY WHEN ARTERIAL PO2 IS OFF SCALE TO RIGHT
      if(IOK(KD)) 108,105,105
  105 XLINE(KD)=O(1)
      GO TO 110
  108 KD=1
C........
  110 if(IOK(KK)) 120,115,115
  115 XLINE(KK)=C(1)
  120 if(IOK(KR)) 130,125,125
  125 XLINE(KR)=F(1)
  130 if(IOK(KH)) 140,135,135
  135 XLINE(KH)=V(1)
  140 if(IOK(KN)) 150,145,145
  145 XLINE(KN)=X(1)
  150 CONTINUE
C*** ALTERNATIVE VERSION *** NEXT FOUR LINES
      MAX=MAX0(KD,KH,KK,KR)
      if(MAX-65) 154,154,152
  152 MAX=65
  154 WRITE (KL,160) J3,ND,(XLINE(I),I=1,MAX)
C     WRITE (KL,160) J3,ND,XLINE
  160 format(1H ,I3,1H.,I2,65A1)
      RETURN
      END
C
C*****************************************************************
C
C-------- OPTIONAL EXTRA SUBROUTINE
C THIS SUBROUTINE IS NOT STRICTLY NECESSARY, BUT ifSPACE ALLOWS
C IT PREVENTS STUDENT USERS ENTERING RIDICULOUS VALUES
      SUBROUTINE CHECK (I,NLOW,NHIGH)
      DIMENSION LIMIT (30,2)
      COMMON KT,KL,INI,NW1,NW2
C*** THE '16000'S IN THE LIST BELOW CAN BE MADE THE HIGHEST VALUE
C OF INTEGER ACCEPTABLE TO THE COMPUTER
      DATA LIMIT/5*0,-200,0,1,5*0,25,0,5,5,2*0,500,-300,-15,1,0,27,5*0,
     X2*100,2*16000,90,2*16000,2*90,4*16000,44,15,2*50,25,80,10000,300,
     X 20,15,16000,43,1,50,5,10,50/
      if(I.LT.31) GO TO 200
      if(NW2.LT.20) WRITE (KT,100) I
  100 format(' *** POINTLESS - FACTOR',I4,' WILL BE CHANGED BACK AGAIN
     XIN THE NEXT RUN')
      NLOW=-100
C*** AS ABOVE, INTEGER SHOULD BE MAXIMUM ALLOWED BY LOCAL COMPUTER
      NHIGH=16000
      RETURN
  200 NLOW=LIMIT(I,1)
      NHIGH=LIMIT(I,2)
      RETURN
      END
C........ END OF ADDED SUBROUTINE
C
C*****************************************************************
C
      SUBROUTINE CLIN1(SIMLT)
C THIS SUBROUTINE PRODUCES PRESET PATIENTS
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,NW
        COMMON NFLAG,J3,ISPAR,NA,NB,NC,ND,NE(8)
        COMMON NARTI,MT,K2,K4,INDEX
      COMMON FIO2,FIC2,CO,PD,FADM,BULLA,VLUNG,ELAST,VADM,AZ,
     X  BZ,CZ,BARPR,TEMP,TRQ,TC2MT,TVOL,HB,PCV,VBLVL,
     X  ADDC3,BC3AJ,DPG,PR,FITNS,SPACE,COMAX,SHUNT,VC,PEEP,
     X  VO2CT,RCOAJ,RPH,VPH,FVENT,BPH,AO2CT,AC2CT,AO2MT,AC2MT,
     X  AO2PR,AC2PR,DPH,XLACT,BO2PR,BC2PR,TIDVL,RRATE,RO2CT,VC2MT,
     X  DVENT,SVENT,PC2CT,PO2CT,TO2CT,TC2CT,BO2CT,BC2CT,TPH,RC3CT,
     X  VC2CT,RO2MT,RC2MT,XRESP,AN2MT,BO2MT,BC2MT,CBF,PC,DSPAC,
     X  REFLV,RO2PR,CONSO,RC2PR,PG,PJ,TND,RC2CT,QB,PW,
     X  FT,CONOM,BUBBL,PK,TC3MT,VC3MT,TC3CT,VC3CT,TLAMT,RLACT,
     X  BC3CT,BO2AD,COADJ,EO2CT,TO2MT,TO2PR,TC2PR,VO2MT,AVENT,PL,
     X  EC2CT,TN2MT,TN2PR,FEV,SN2PR,EN2CT,UN2MT,RN2MT,HRATE,STRVL,
     X  TC3AJ,SN2MT,QA,RVADM,XDSPA,BAG,XMALE,HT,WT,AGE
      if(NW2.GT.19) GO TO 110
      WRITE (KT,100)
  100 format(' DO YOU WANT..1.PRESET PATIENTS OR  SUBJECTS',/,' 2.TO SP
     XECIFY YOUR OWN PATIENTS  OR SUBJECTS')
      NW2=0
  110 NA=18
      FT=.016667
      NARTI=1
      ISPAR=1
      NEOF=1
      CALL NXTWD (7,XXX,NNN,1,2)
      GO TO (120,280), NNN
  120 if(NW2.GT.19) GO TO 140
      WRITE (KT,130)
  130 format(' THE FOLLOWING PRESET PATIENTS ARE AVAILABLE ',/,' 1. NOR
     XMAL FIT SUBJECT EXERCISING AT 300 KPM/MIN',/,' 2. SAME, AT 900 KPM
     X/MIN',/,' 3. UNFIT NORMAL SUBJECT EXERCISING AT 900 KPM/MIN',/,' 4
     X. NORMAL SUBJECT, COMPRESSED TO 10 ATMOSPHERES FOR 25 MINUTES',/,'
     X 5. CHRONIC AIRWAYS OBSTRUCTION WITH VENTILATORY FAILURE',/,' 6. S
     XAME, BUT WITH ACUTE EXACERBATION, EG. ADDED BRONCHOPNEUMONIA',/,'
     X7. CHEYNE-STOKES BREATHING DUE TO BRAIN STEM DAMAGE AND HEART DISE
     XEASE',/,' ...TYPE NUMBER')
      FT=.016667
      NW2=0
  140 CALL NXTWD (7,XXX,NNN,1,7)
      GO TO (150,160,170,190,200,240,250), NNN
C++PRESET 1 - NORMAL SUBJECT EXERCISING AT 300 KPM/MIN
  150 PD=400.
      TRQ=.88
      GO TO 180
C++PRESET 2 - NORMAL SUBJECT EXERCISING AT 900 KPM/MIN
  160 PD=800.
      TRQ=.98
      GO TO 180
C++PRESET 3 - UNFIT NORMAL SUBJECT EXERCISING AT 900 KPM/MIN
  170 FITNS=35.5
      GO TO 160
  180 NA=36
      GO TO 260
C++PRESET 4 - NORMAL SUBJECT COMPRESSED FOR 25 MIN
  190 BARPR=7600.*SIMLT
      NA=30
      SN2MT=2750.
      J3=20
      GO TO 230
C++PRESET 5 - CHRONIC AIRWAYS OBSTRUCTION WITH VENTILATORY FAILURE
  200 VADM=28.
      VC=1.2
      VLUNG=5000.
  210 PR=30.
      TC3MT=480.
      BC3AJ=4.
      TC2MT=15.7
      VC2MT=2600.
      BC2MT=1000.
      ELAST=34.
  220 NA=72
  230 ISPAR=2
      GO TO 260
C++PRESET 6 - CHRONIC AIRWAYS OBSTRUCTION WITH ACUTE EXACERBATION
  240 VC=1.
      BULLA=30.
      VADM=60.
      XDSPA=30.
      AZ=50.
      VLUNG=7000.
      GO TO 210
C++PRESET 7 - CHEYNE-STOKES BREATHING DUE TO BRAIN STEM DAMAGE + HEART
C   DISEASE.
  250 CZ=0.
      AZ=160.
      BZ=50.
      CO=58.
      VADM=30.
      XRESP=0.
      AC2MT=90.
  255 FT=.16667
  260 NB=2
      if(NW2.GT.19) RETURN
      WRITE (KL,270)
  270 format(' TIME SCALE IS ALTERED FOR THIS SIMULATION',/,' WAIT WHIL
     XE I WORK THIS OUT ')
      RETURN
C++ CLIN2 IS THE ROUTINE FOR CREATING INDIVIDUAL PATIENTS AND INSERTING
C PULM. FUCNTION TEST RESULTS
  280 CALL CLIN2
      GO TO 220
      END
C
C*****************************************************************
C
      SUBROUTINE CLIN2
C THIS SUBROUTINE IS USED ONLY FOR CREATING SUBJECTS TO ORDER,
C AND FOR ALLOWING AS FAR AS POSSIBLE FOR FUNCTION TEST RESULTS
        DIMENSION T(120),ARRAY(3,10)
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,NW
        COMMON NFLAG,J3,ISPAR,NA,NB,NC,ND,NE(8)
        COMMON NARTI,MT,K2,K4,INDEX
      COMMON FIO2,FIC2,CO,PD,FADM,BULLA,VLUNG,ELAST,VADM,AZ,
     X  BZ,CZ,BARPR,TEMP,TRQ,TC2MT,TVOL,HB,PCV,VBLVL,
     X  ADDC3,BC3AJ,DPG,PR,FITNS,SPACE,COMAX,SHUNT,VC,PEEP,
     X  VO2CT,RCOAJ,RPH,VPH,FVENT,BPH,AO2CT,AC2CT,AO2MT,AC2MT,
     X  AO2PR,AC2PR,DPH,XLACT,BO2PR,BC2PR,TIDVL,RRATE,RO2CT,VC2MT,
     X  DVENT,SVENT,PC2CT,PO2CT,TO2CT,TC2CT,BO2CT,BC2CT,TPH,RC3CT,
     X  VC2CT,RO2MT,RC2MT,XRESP,AN2MT,BO2MT,BC2MT,CBF,PC,DSPAC,
     X  REFLV,RO2PR,CONSO,RC2PR,PG,PJ,TND,RC2CT,QB,PW,
     X  FT,CONOM,BUBBL,PK,TC3MT,VC3MT,TC3CT,VC3CT,TLAMT,RLACT,
     X  BC3CT,BO2AD,COADJ,EO2CT,TO2MT,TO2PR,TC2PR,VO2MT,AVENT,PL,
     X  EC2CT,TN2MT,TN2PR,FEV,SN2PR,EN2CT,UN2MT,RN2MT,HRATE,STRVL,
     X  TC3AJ,SN2MT,QA,RVADM,XDSPA,BAG,XMALE,HT,WT,AGE
      EQUIVALENCE (FIO2,T(1))
C ARRAY STORES NORMAL FUNCTION TESTS' RESULTS FOR FUNCTIONS
C USED LATER (FUNC1 AND FUNC2)
      DATA ARRAY/.026,.009,2.18,.047,.0075,4.583,
     X .0452,.024,2.852,.0582,.025,4.241,.035,.025,1.932,
     X .0363,.032,1.26,.382,.732,100.,-.125,.951,100.,
     X .221,.683,100.,-.011,.782,100./
      FUNC1(HT,AGE,X,Y,Z)=X*HT-Y*AGE-Z
      FUNC2(HT,X,Y)=X+(HT*.01)**3*Y
C INITIALISE PREDICTED FEV,VC AND DCO IN CASE NEXT SECTION SKIPPED
      PFEV=FEV
      PVC=VC
      PDCO=20.
      if(NW2.GT.19) GO TO 110
      WRITE (KT,100)
  100 format(' 70 KG AVERAGE MAN. DO YOU WANT TO SPECIFY SOMEONE ELSE..
     X1.YES, 2.NO')
      NW2=0
  110 CALL NXTWD (7,XXX,NNN,1,2)
      GO TO (120,280), NNN
C+++ BUILD UP THE SPECIFIED SUBJECT
  120 if(NW2.GT.19) GO TO 140
      WRITE (KT,130)
  130 format(' PLEASE SPECIFY..1.MALE, 2.FEMALE')
      NW2=0
  140 CALL NXTWD (7,XXX,NNN,1,2)
      if(NNN.EQ.2) XMALE=0.
      if(NW2.GT.19) GO TO 160
      WRITE (KT,150)
  150 format(' GIVE ME THE HEIGHT IN CM (183 CM=6 FT)')
      NW2=0
  160 CALL NXTWD (7,HT,NNN,95,200)
      if(NW2.GT.19) GO TO 180
      WRITE (KT,170)
  170 format(' NOW WEIGHT IN KG')
      NW2=0
  180 CALL NXTWD (7,WT,NN,20,200)
      RAT=WT*5880./HT**1.6
      if(XMALE.LT..5) RAT=RAT*1.064
      if(NW2.GT.19) GO TO 200
      WRITE (KT,190)
  190 format(' AND AGE IN YEARS')
      NW2=0
  200 CALL NXTWD (7,AGE,NNN,8,100)
      K=INT(XMALE)+1
      VLUNG=FUNC1(HT,AGE,ARRAY(1,K),ARRAY(2,K),ARRAY(3,K))
      K=K+2
      X=ABS(20.-AGE)
      PDCO=(7.6*VLUNG+5.)*(100.-X)*.01
      VLUNG=VLUNG*1000.
      if(AGE.LT.17.) GO TO 210
      PVC=FUNC1(HT,AGE,ARRAY(1,K),ARRAY(2,K),ARRAY(3,K))
      K=K+2
      PFEV=FUNC1(HT,AGE,ARRAY(1,K),ARRAY(2,K),ARRAY(3,K))
      GO TO 220
  210 K=K+4
      PVC=FUNC2(HT,ARRAY(1,K),ARRAY(2,K))
      K=K+2
      PFEV=FUNC2(HT,ARRAY(1,K),ARRAY(2,K))
  220 CONSO=WT**.75*10.33
      X=PVC-PFEV-.1
      if(X.LT.0.) PVC=PFEV+.1
      CONOM=CONSO*.0195
      if(XMALE.GT..5) GO TO 230
      CONOM=CONOM*.9
      HB=13.5
      PCV=41.
  230 VBLVL=CONOM*300.+1500.
      TVOL=(WT**.6*.465)+6.
      X=TVOL*.084
      TC3MT=TC3MT*X**1.35
      TC2MT=TC2MT*X
      SN2MT=SN2MT*X
      WRITE (KT,240) PFEV,PVC,PDCO,CONSO,CONOM,RAT
  240 format(14X,'LITRES',4X,'CC/MM/MIN',4X,'CC/MIN',4X,'LITRES/MIN',5X
     X,' :IDEAL',/,1X,'PREDICTED  FEV1',4X,'VC  DIFF.CAP.   O2 CONSN.  C
     XARD.OUTPUT     WEIGHT',/,13X,F3.1,F6.1,F9.1,F12.0,F12.1,F13.0,/)
      COMAX=(210.-.65*AGE)*.0008*HT
      if(NW2.GT.19) GO TO 260
      NW2=0
      WRITE (KT,250)
  250 format(' DO YOU WANT TO ENTER SPIROMETRY RESULTS..1.YES, 2.NO')
  260 CALL NXTWD (7,XXX,NNN,1,2)
      GO TO (280,270), NNN
  270 VC=PVC
      FEV=PFEV
      GO TO 400
C+++ INCORPORATE SPIROMETRY RESULTS
  280 if(NW2.GT.19) GO TO 310
  290 WRITE (KT,300)
  300 format(' GIVE ME THE VALUE FOR FEV1 IN LITRES')
      NW2=0
  310 CALL NXTWD (7,FEV,NNN,0,6)
      if(FEV.GT..13) GO TO 330
      WRITE (KT,320)
  320 format(' VERY UNLIKELY - RECHECK AND')
      GO TO 290
  330 if(NW2.GT.19) GO TO 360
  340 WRITE (KT,350)
  350 format(' NOW THE VALUE FOR VC')
      NW2=0
  360 CALL NXTWD (7,VC,NNN,0,7)
      if(VC.GE..2) GO TO 380
      WRITE (KT,370)
  370 format(' PROBABLY A TECHNICAL ERROR - PLEASE REPEAT')
      GO TO 340
  380 if(VC.GT.FEV) GO TO 400
      WRITE (KT,390)
  390 format(' IT CAN NEVER BE THE SAME AS, OR LESS THAN THE FEV1.',/,'
     X LET*S HAVE BOTH AGAIN TO BE SURE')
      GO TO 290
  400 RATIO=FEV/VC
      X=RATIO*100.
      WRITE (KT,410) RATIO,X
  410 format(' THE FEV1/VC RATIO IS ',F4.2,' I.E. ',F4.0,' PER CENT')
      RAT=PFEV/FEV
      TAR=1./RAT
      XDSPA=20.*RAT**.7-20.
      if(RATIO.GE.0.65) GO TO 460
      WRITE (KT,420)
  420 format(' THESE VALUES INDICATE AIRWAYS OBSTRUCTION.',/)
      if(NW2.GT.19) GO TO 440
      WRITE (KT,430)
  430 format(' IS YOUR PATIENT',/,'...1.ACUTELY BREATHLESS,  2.NOT MUCH
     X CHANGED IN LAST WEEK OR SO')
      NW2=0
  440 CALL NXTWD (7,XXX,NNN,1,2)
C++ SET VALUES FOR OBSTRUCTED SUBJECT
      VLUNG=VLUNG*(.5+.43/RATIO)
      if(NNN-1) 450,445,450
C ACUTE OBSTRUCTION ONLY
  445 ELAST=FEV+60./(FEV+1.)-11.
      VADM=2.*RAT**1.7
      if(VADM.GT.85.) VADM=85.
      CZ=30.*RAT+70.
      if(CZ.GT.140.) CZ=140.
      if(FEV.LT.1.) CZ=140.*FEV
      GO TO 580
C++ ADD IN CHANGES APPROPRIATE FOR CHRONIC OBSTRUCTED SUBJECTS
  450 BC3AJ=.35*RAT-.35
      ELAST=FEV+96./(FEV+4.)-11.
      X=1.2*RAT-1.2
      if(X.LE.0.) X=0.
      X=X**.52
      if(PFEV-FEV-2.5) 454,452,452
  452 PR=(FEV+3.)*21.
  454 TC3MT=TC3MT+TVOL*3.*X
      CZ=10.*RAT+90.
      XDSPA=XDSPA*1.2
      VADM=2.*RAT**1.1
      TC2MT=TC2MT+TVOL*.045*X
      GO TO 470
C++ UNOBSTRUCTED SUBJECTS
  460 VADM=VADM*RAT**1.6
      if(FEV.LT.1.) VADM=7.*RAT
      ELAST=FEV+72./(FEV+2.)-11.
      CZ=20.*RAT+80.
  470 if(NW2.GT.19) GO TO 490
      WRITE (KT,480)
  480 format(' HAVE YOU MEASURED DIFFUSING CAPACITY..1.YES,  2.NO ')
      NW2=0
  490 CALL NXTWD (7,XXX,NNN,1,2)
C+++ INCORPORATE DIFFUSING CAPACITY MEASUREMENTS
C REMAINING STATEMENTS ADJUST EFFECTIVE VENOUS ADMX. ACCORDING TO DIFF.
C CAPACITY ESTIMATES OR MEASUREMENTS.
      GUESS=PDCO*(1.+TAR)*.5
      if(NNN.EQ.1) GO TO 510
      WRITE (KT,500) GUESS
  500 format(' IN THAT CASE I SHALL ASSUME THAT IT IS ',F4.1,' CC/MM HG
     X/MIN.',/,' THIS WOULD BE AN AVERAGE SORT OF FIGURE FOR YOUR SUBJEC
     XT',/)
      GO TO 580
  510 if(NW2.GT.19) GO TO 530
      WRITE (KT,520)
  520 format(' GOOD. PLEASE GIVE ME YOUR VALUE IN CM/MM HG/MIN')
      NW2=0
  530 CALL NXTWD (7,XXX,NNN,3,100)
      X=PDCO+7.
      if(XXX.LT.X) GO TO 550
      WRITE (KT,540) GUESS
  540 format(' THIS SEEMS LIKE NONSENSE, UNLESS THE VALUE WAS OBTAINED
     XDURING EXERCISE',/,' I AM GOING TO ASSUME IT WAS ',F4.1)
      XXX=GUESS
  550 TEST=XXX/GUESS
      if(TEST.LT.1.4.AND.TEST.GT..6) GO TO 570
      WRITE (KT,560)
  560 format(' UNUSUAL... BUT YOU*RE THE BOSS',/)
C MAKE CHANGE WITH DIFFERENT DIFFUSING CAP. REALLY DIFFERENT
  570 RVADM=GUESS/XXX-1.
      XDSPA=XDSPA*2./(1.+TEST)
  580 BO2MT=30.
      TO2MT=700.
      if(ELAST.GT.75.) ELAST=75.
      RETURN
      END
C
C*****************************************************************
C
C-------- OPTIONAL EXTRA SUBROUTINE
C NEW BUT NOT ESSENTIAL SUBROUTINE, SUPPLYING COMMENTS FOR USERS
C WHO ENTER SURPRISING VALUES
      SUBROUTINE COMMT (I,XXX)
      COMMON KT,N(103),FIO2,FIC2,T(15),HB
      GO TO (100,130,160,170,190,210,230,320,320,320,320,320,320,320,320
     X,250,250,270,320,250,320,320,320,320,290,320,320,320,310,320), I
  100 if(XXX.GE.10.) GO TO 330
      WRITE (KT,110)
  110 format(' YOUR SUBJECT ISN*T GOING TO LIKE THIS MUCH')
      WRITE (KT,120)
  120 format(' UNLESS BAROMETRIC PRESSURE IS ABOVE NORMAL')
      GO TO 330
  130 if(XXX.LT.21.) GO TO 140
      WRITE (KT,150)
      GO TO 340
  140 if(XXX.LT.9.) GO TO 340
      WRITE (KT,110)
  150 format(' THIS WILL BE HORRIBLE ')
      GO TO 340
  160 if(XXX.LT.10.) WRITE (KT,150)
      GO TO 320
  170 if(XXX.GT.2800.) WRITE (KT,180)
  180 format(' THIS IS ABOVE THE PROBABLE MAXIMUM ENERGY USED EVEN DURI
     XNG SPRINTING')
      GO TO 320
  190 if(XXX.GT.60.) WRITE (KT,200)
  200 format(' THAT*S A BIG SHUNT, EVEN FOR FALLOT*S ')
      GO TO 320
  210 if(XXX.LT.3500.) GO TO 220
      WRITE (KT,150)
      GO TO 320
  220 if(XXX.LT.2500.) GO TO 320
      WRITE (KT,110)
      GO TO 320
  230 if((XXX.LT.1000.).OR.(XXX.GT.12000.)) WRITE (KT,240)
  240 format(' THAT*S A BIT RIDICULOUS ')
      GO TO 320
  250 if(XXX.LT.6.) WRITE (KT,260)
  260 format(' THAT*S REALLY UNPHYSIOLOGICALLY LOW')
      GO TO 320
  270 if(XXX.LT.HB) WRITE (KT,280)
  280 format(' A FALL OF HB WITHOUT CHANGE IN O2 CONTENT WILL RAISE PO2
     X ')
      GO TO 320
  290 if(XXX.GT.37.) WRITE (KT,300)
  300 format(' THAT WILL BE VERY UNFIT INDEED ')
      GO TO 320
  310 if(XXX.LT..7) WRITE (KT,260)
  320 RETURN
  330 if(XXX+FIC2-100.03) 320,320,350
  340 if(XXX+FIO2-100.) 320,320,350
  350 WRITE (KT,360)
  360 format(' IMPOSSIBLE GAS MIXTURE - THINK AGAIN')
      RETURN
      END
C........ END OF ADDED SUBROUTINE
C
C*****************************************************************
C
      SUBROUTINE CONST(C,NREPT,SIMLT)
C THIS S/R COMPUTES ALL PARAMETERS CONSTANT DURING A RUN
C-------- ADDS TO C(), CHANGES COMMON, AND CHANGES SCALE FIGURES
      DIMENSION C(75)
        COMMON KT,KL,N(102)
        COMMON FIO2,FIC2,CO,PD,FADM,BULLA,VLUNG,ELAST,VADM,AZ,
     X    BZ,CZ,BARPR,TEMP,TRQ,TC2MT,TVOL,HB,PCV,VBLVL,
     X    ADDC3,BC3AJ,DPG,PR,FITNS,SPACE,COMAX,SHUNT,VC,PEEP,
     X    VO2CT,RCOAJ,T(10),DPH,T2(3),TIDVL,RRATE,T3(24),CONSO,T4(7),FT,
     X    CONOM,T5(16),AVENT,PL,T6(3),FEV,T7(4),T8(4),QA,RVADM,
     X    XDSPA,BAG,XMALE,HT,WT,AGE
C-------- SKIP ARRANGEMENTS FOR SITUATIONS WHEN ENTRIES ARE MULTIPLE,
C         EG.  2/2/2/2
      DATA N2/2/
      if(N(2).LE.4) GO TO 10
      I=N(2)+3
      if(N(I).EQ.N2) GO TO 111
10    if(N(88).GT.1.OR.N(87).EQ.1.OR.N(5).EQ.0) GO TO 111
C........
C*** PLACE BRACKETS AROUND SCALE FIGURES FOR LEAST USED UNITS
      WRITE (KL,100)
100   FORMAT(' (KPA)(0)',12X,'(4)',12X,'(8)',11X,'(12)',11X,'(16)',/,
     X1X,'MM HG 0',8X,'20',8X,'40',8X,'60',8X,'80',8X,'100',7X,'120')
      WRITE (KL,110)
  110 format(8H MN.SEC.,12(4X,1H.))
  111 X=TIDVL*RRATE
C-------- ALLOWS FIXING LOW CARD.OUTPUT WITHOUT ITER.INTERVAL CHANGE
C FIRST BRACKETED PARTS OF NEXT 2 STATEMENTS PREVENT AUTOMATIC REDUCTION
C OF ITERATION INTERVAL ifMAXIMUM CARDIAC OUTPUT (COMAX) IS LOW - THUS
C ALLOWING AN OPERATOR TO FIX CARDIAC OUTPUT BY INCREASING CO AND
C REDUCING COMAX.  OTHER PARTS ANTICIPATE NEED FOR SHORTENING OF THE
C ITERATION INTERVAL UNDER CERTAIN CONDITIONS
      XX=BARPR/SIMLT
      if(((CO.GT.340..AND.COMAX.GT.15.).OR.PD.GT.950..OR.SHUNT.GT..5
     X .OR.XX.LT.150.).AND.
     X FT.GT..04) GO TO 112
      if(((CO.GT.210..AND.COMAX.GT.10.).OR.PD.GT.350..OR.FIO2.LT.7..OR.
     X CO.LT.5..OR.XX.LT.350..OR.PR.LT.5..OR.X.LT.1..OR.PL.LT.0.)
     X .AND.FT.GT..09) GO TO 114
      GO TO 120
  112 FT=.0333334
      GO TO 116
  114 FT=.0833334
  116 WRITE (KT,118)
  118 format(' ITERATION INTERVAL TOO LONG FOR THIS SITUATION.  I HAVE
     XSHORTENED IT.',/,' TO CHANGE BACK, USE *4.RUN CHANGE* OPTION',/)
  120 if((N(98).EQ.0.AND.X.LT.1.).OR.PL.LT.-.5.OR.PR.LT.1.) AVENT=.001
C........(MAKE SURE ARRAY () VALUES HAVE BEEN CHANGED, IN ALL THE ABOVE)
      if(TEMP.GE.30.) GO TO 140
      WRITE (KT,130)
  130 format(' *SORRY - NO CAN DO - LET*S SAY 30 DEGREES')
      TEMP=30.
  140 C(1)=1000./VBLVL
      C(2)=100./VBLVL
      C(3)=.0203*HB
      C(4)=(ELAST+105.)*.01
      C(5)=2.7/(VC+.4)
      C(6)=FEV*25.+29.
      C(7)=CONSO*PD*.00081*(TEMP-26.)**1.05
      C(8)=(30.-PEEP*5./ELAST)*.0016*CONOM*(TEMP-12.2)
      C(9)=(C(7)-CONSO)*.0067
      C(10)=FT*.005
C-------- IMPROVED WATER VAPOUR PRESSURE CORRECTION
      C(11)=XX-.03*TEMP*TEMP-5.92
C........
      C(12)=C(11)*.003592/(273.+TEMP)
      C(13)=.9/TVOL
      C(14)=SHUNT+1.
      C(15)=2./WT
      C(16)=CO*.01
      C(17)=FT*10.
      C(18)=VADM*80.
      C(19)=(PD-90.)*RVADM*.05
      if(C(19).LT.-1.) C(19)=-1.
      C(20)=650.*VC
      if(BULLA.GT.0.) C(20)=C(20)+SQRT(BULLA)*15.
      C(21)=(40.-PEEP)*.025
      C(22)=4.5/FT
      C(23)=20.*SIMLT/BARPR
      C(24)=CONOM*.3
      C(25)=100.*C(12)
      C(26)=7./TVOL
      C(27)=FT*.1
      C(28)=30000./(VBLVL+1000.)
      C(29)=FT*.0039*WT**.425*HT**.725
      C(30)=520./TVOL
      C(31)=2.7/TVOL
      C(32)=C(29)+.0000001
      C(33)=C(3)*308.-TVOL*.65*C(30)
      C(34)=.004/(C(12)*FT)
      C(35)=.01/C(12)
      C(36)=7.7*C(13)
      C(37)=SPACE/FT
      C(38)=20./VLUNG
      C(39)=FT*.127
      C(40)=C(29)*(PD-25.)*1.3
      C(41)=FT*(TEMP-24.5)*1.82
      C(42)=.003*C(29)
      C(43)=1./(1.+7.7*C(3))
      X=(PD*.01)**.8*VC*.2
      C(44)=AZ*X*.0132
      C(45)=BZ*X*.008
      C(46)=CZ*.78*((C(7)*.00051)**.97+.01)
      X=.5+356./C(11)
      if(X.GT.1.) X=1.
      C(47)=PR*.000214*(TEMP-29.)**1.5*X
      C(48)=.04*(TEMP-26.)*VC
      C(49)=9.+SQRT(ELAST*1.25)
      C(50)=(150.+PR)*.0275*(TEMP-17.)
      C(51)=RRATE*TIDVL*.001
      C(52)=VLUNG*.03-20.+BULLA
      C(53)=.8/FT
      C(54)=XDSPA*.001
      C(55)=.1/FT
      C(56)=.001/FT
      C(57)=FT*60.
      C(58)=FT*1.27
      C(59)=FT*.3
      C(60)=FT*.008
C--------- REDUCE RATE OF CARDIAC OUTPUT INCREASE AT START EXERCISE
      X=(PD*.01)**1.45
      IF(X.GT.12.) X=12.
      C(61)=.00025*RCOAJ/(FT*X)
C..........
      C(62)=FT*240000./(CZ+300.)
      C(63)=FT*C(7)*.12
      C(64)=.01488*HB*(TVOL+VBLVL*.001)
      C(65)=7.324-CZ*.00005
      C(66)=C(65)-.002
      C(67)=CZ-30.
C--------- REDUCE RATE OF INCREASE VENTILATION AT START EXERCISE
      C(68)=FT*1500./(PD+200.)
C.........
      C(69)=(FITNS-20.)*.00035
      C(70)=C(29)*1.3
C-------- EXTRA CONSTANTS FOR 2,3-DPG CHANGES + FITNESS
      C(71)=21.7+XMALE*1.6
      C(72)=FT*.002
      X=(PD*1.5-150.)*.02-7.
      if(X.LT.-7.) X=-7.
      if(X.GT.0.) X=0.
      C(73)=FITNS+X
C........
      ADDC3=ADDC3/FLOAT(NREPT)
      DPH=7.4+(DPG-3.8)*.025
      if(DPH.GT.7.58) DPH=7.58
      if(DPG.GT.13.) DPG=13.
C+++++++++++++++++++++++++++++++++++++++++++
C TWO ADDED CONSTANTS FOR HEARTRATE DETERMINATION
C C(74) FOR MAXIMAL HEARTRATE, C(75) RELATES MAX. STROKEVOLUME
C TO SEX, FITNESS AND WEIGHT
      C(74)=210.-.65*AGE
      C(75)=(1.5+XMALE*.2+(33.-FITNS)/10.)*WT*C(16)
C+++++++++++++++++++++++++++++++++++++++++++++
      RETURN
      END
C-------- ELIMINATES LL2
C
C*****************************************************************
C subject: part2 of mcpuff with hr modifications
C
      SUBROUTINE DEADY (LL1,LL4,LL5,NREPT,SIMLT)
C........
C THIS SR. PRINTS OUT VALUES AT THE END OF A RUN, AND ASKS FOR,
C INTERPRETS AND ACTS ON VARIOUS CHANGE OPTIONS, USING S/R NXTWD TO
C INPUT KEYBOARD INSTRUCTIONS. THEN RETURN TO MAIN PROGRAMME
        DIMENSION T(120),IANS(10),ICHAR(6),FUN3(20)
C-------- INCREASE DIMENSION OF ICHAR, AND IN 'DATA'
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,
     X    NW
        COMMON /PLOT/ KPLOT,KDATF,WRATE,EFFIC,FUN3
        COMMON /KWVTT/ KWVT,CATLIV,CATCID,CATMUS,AFBR1,AFBR2,PROD,
     X   CATOX
        COMMON NFLAG,J3,ISPAR,NA,NB,NC,ND,NE(8)
        COMMON NARTI,MT,K2,K4,INDEX
        COMMON FIO2,FIC2,CO,PD,FADM,BULLA,VLUNG,ELAST,VADM,AZ,
     X    BZ,CZ,BARPR,TEMP,TRQ,TC2MT,TVOL,HB,PCV,VBLVL,
     X    ADDC3,BC3AJ,DPG,PR,FITNS,SPACE,COMAX,SHUNT,VC,PEEP,
     X    VO2CT,RCOAJ,RPH,VPH,FVENT,BPH,BAGO,BAGC,AO2MT,AC2MT,
     X    AO2PR,AC2PR,DPH,XLACT,BO2PR,BC2PR,TIDVL,RRATE,RO2CT,VC2MT,
     X    DVENT,SVENT,PC2CT,PO2CT,TO2CT,TC2CT,BO2CT,BC2CT,TPH,RC3CT,
     X    VC2CT,RO2MT,RC2MT,XRESP,AN2MT,BO2MT,BC2MT,CBF,PC,DSPAC,
     X    REFLV,RO2PR,CONSO,RC2PR,PG,PJ,TND,RC2CT,QB,PW,
     X    FT,CONOM,BUBBL,TC2RF,TC3MT,VC3MT,TC3CT,VC3CT,TLAMT,RLACT,
     X    BC3CT,BO2AD,COADJ,EO2CT,TO2MT,TO2PR,TC2PR,VO2MT,AVENT,PL,
     X    EC2CT,TN2MT,TN2PR,FEV,SN2PR,EN2CT,UN2MT,RN2MT,HRATE,STRVL,
     X    TC3AJ,SN2MT,QA,RVADM,XDSPA,BAG,XMALE,HT,WT,AGE,TIME
        EQUIVALENCE (FIO2,T(1))
        DATA ICHAR/1H1,1H/,1H5,1H/,1H ,1H5/
C........
      IF(LL1-2) 360,380,300
  300 WRITE (KT,310)
  310 FORMAT(' ..1.BACKTRACK, 2.CONTINUE, 3.RESTART, 4.INSPECT, 5.STOP')
      NW2=0
      CALL NXTWD (7,XX,NNN,1,6)
      GO TO (330,600,600,500,1120,610), NNN
  330 NW=0
      GO TO 920
  360 ITRIG(73)=ITRIG(73)+1
      if(NC-2) 370,1110,1110
C--------- ADDS PRINT SKIP INSTRUCTION (NPRT) AND STOPS TABLE PRINTING
C          ON LONG RUNS OF 'CONTINUE' (EG 2/2/2/2/2 ETC)
  370 if(NB.EQ.1.OR.NPRT.EQ.0) GO TO 470
      if(MT.LT.1) GO TO 1110
  380 if(NW2.GT.19.AND.ITRIG(NW1).NE.ICHAR(6)) GO TO 1110
C........
      X=10.*2.**(ABS(8.-RPH)*3.33)
      WRITE (KL,390) RO2PR,RO2CT,PJ,RC2PR,RC2CT,RPH,X,RC3CT
  390 format(/,' FINAL VALUES FOR THIS RUN WERE...',//,' ARTERIAL PO2 =
     X',F6.1,'  O2 CONT =',F6.1,', O2 SAT=',F5.0,':',/,' ARTERIAL PCO2='
     X,F6.1,'  CO2 CONT=',F6.1,/,' ARTERIAL PH =',F5.2,'(',F4.0,'NM), AR
     XTERIAL BICARBONATE =',F5.1,/)
      WRITE (KL,400) RRATE,TIDVL,DVENT,COADJ,DSPAC,PW,HRATE,STRVL
  400 format(' RESPIRATORY RATE =',F5.1,', TIDAL VOL.=',F6.0,' ML',/,'
     XTOTAL VENTILATION=',F6.1,' L/MIN, ACTUAL CARD.OUTPUT=',F6.1,' L/MI
     XN',/,' TOTAL DEAD SPACE=',F5.0,' CC, ACTUAL VENOUS ADMIXTURE=',F6.
     X1,' PERCENT',/' HEART RATE=',F4.0,' STROKEVOLUME=',F6.3,/)
      if(LL1.EQ.2) GO TO 300
C ITRIG(73) CONTROLS PRINT OUT OF THE FIRST 6 FACTORS AT THE END OF RUN
      if(ITRIG(73).GT.2) GO TO 1110
      WRITE (KT,410) (T(I),I=1,6)
  410 format(' 1.INSP.O2=',F5.0,', 2.CO2=',F5.0,' PERCENT, 3.','NOM.CAR
     XD.OUTP.=',F5.0,'PER CENT',/,' 4.TISS.METAB.=',F5.0,' , 5.VENOUS','
     X ADMXT.=',F5.0,' ,  6.D.SPACE+=',F6.0,' ML',/)
      if(ITRIG(73).EQ.2) WRITE (KT,420)
  420 format(' (THE FACTOR LIST ABOVE WILL NOW DISAPPEAR - REFER TO HAN
     XDBOOK)')
      GO TO 1110
  430 NW=0
      CALL CLIN1(SIMLT)
      if(NB.EQ.2) RETURN
      GO TO 470
C ifNOT NEW SUBJECT(NW=0) INSERT '1/5/' IN INPUT BUFFER TO
C RENEW THE SUBJECT FROM INITIAL VALUES, THEN RETURN TO CLIN1
  440 if(NW.GT.0) GO TO 430
      NB=1
      KYY=69-NW1
      DO 450 I=1,KYY
  450 ITRIG(73-I)=ITRIG(69-I)
      DO 460 I=1,4
  460 ITRIG(NW1+I-1)=ICHAR(I)
      if(NW2.LE.19) ITRIG(NW1+3)=ICHAR(5)
      NW2=20
      GO TO 600
  470 if(NW2.GT.19) GO TO 490
      WRITE (KT,480)
C*** A SLASH(/) LINEFEED AT THE END OF THE NEXT formatSTATEMENT
C CAN BE DELETED ifSUBROUTINE NXTWD CONTAINS THE CARRIAGE RETURN
C formatFOR PROMPTING READ, USING A QUESTION MARK
  480 format('  DO YOU WANT TO..1.CHANGE,2.CONTINUE,3.RESTART,4.INSPECT
     X,5.STOP')
      WRITE (KT,485)
  485 format(' .0.RUN WITHOUT PRINT,6.PRINT ALL VALUES,7.PRINT ERGOMETE
     XR VALUES,',/,'  NOTE:OPTIONS 4-7 WITHOUT RUN')
      NW2=0
C--------- NEW OPTION '0' WORKS THE SAME WAY AS '2.CONTINUE' EXCEPT
C          THAT IT SUPPRESSES REGULAR PRINTOUT
  490 CALL NXTWD (15,XXX,NNN,0,7)
      JKL=0
      I=NNN+1
      GO TO (625,640,630,600,500,1120,610,604), I
C..........
  500 X=T(22)+T(91)
      Y=T(16)*1000.
      WRITE (KL,510) T(72),T(74),T(49),T(78),T(62),T(63),T(33),T(60),T(4
     X1),T(42),T(76),T(39),T(40),T(41),T(42),T(54),T(53),T(45),T(46),T(5
     X7),T(58),T(66),T(67),T(36),X,T(96),T(97),T(55),T(56),T(95),Y,T(59)
     X,T(96),T(97),T(31),T(61),T(98),T(50),T(34),T(88)
  510 format('              P.PRESSURES     CONTENTS CC:   AMOUNTS IN C
     XC   PH    HCO3-',/,12X,3(3X,'O2',5X,'CO2',3X),//,' ARTERIAL ',4F8.
     X1,2F8.0,F7.3,F6.1,/,' ALV./LUNG',2F8.1,' (SAT=',F4.0,':)',4X,2F8.0
     X,/,' (PULM.CAP)',F7.1,3F8.1,/,' BRAIN/CSF',4F8.1,2F8.0,F7.3,F6.1,/
     X,' TISSUE/ECF',F7.1,'  (',F5.1,')',F7.1,F8.1,2F8.0,F7.3,/,' MIXED
     XVEN. (',F5.1,') (',F5.1,')',F7.1,F8.1,2F8.0,F7.3,F6.1)
      if(PL.GE.1.) CALL BAGER (7,X,Y,PPH,SIMLT)
      WRITE (KL,520) RLACT
  520 format(' PLASMA LACTATE CONC.=',F4.1,' MMOL/L')
      if(LL1.EQ.2.OR.LL5.LT.0) GO TO 300
      RR=DSPAC/(TIDVL+.000001)
      X=QA/FT
      Y=QB/FT
      WRITE (KL,530) X,Y,PC
  530 format(/,' O2 UPTAKE= ',F6.0,'  CO2 OUTPUT= ',F6.0,' CC/MIN(STPD)
     X EXPIRED R.Q.=',F5.2)
      WRITE (KL,540) DVENT,FVENT,RRATE,PW
  540 format(' TOT.VENT.=',F5.1,'  ALV.VENT(BTPS)=',F4.1,' R.RATE=',F4.
     X1,'  VEN.ADMX.=',F4.1)
      if(DVENT.LT..2) GO TO 560
      WRITE (KL,550) DSPAC,TIDVL,RR
  550 format(' DEAD SPACE(BTPS)=',F5.0,'  TIDAL VOL.=',F5.0,' D.SP./TID
     X.VL.RATIO=',F4.2)
  560 if(COADJ.GT..1) WRITE (KL,570) COADJ,CBF
  570 format(' CARDIAC OUTPUT=',F5.1,'   CEREBRAL BLOOD FLOW=',F4.0,' M
     XL/100G/MIN')
      WRITE(KL,575) HRATE,STRVL
 575  FORMAT(' HEARTRATE=',F4.0,' STROKEVOLUME=',F6.3)
      if(BUBBL.GT.0.) WRITE (KL,580) BUBBL
  580 format(' NITROGEN SUPERSATURATION INDEX=',F6.0)
      if(PL.LT.0.) CALL BAGER (6,X,Y,PPH,SIMLT)
  585 WRITE (KL,590)
  590 format(/)
      if(LL1-2) 470,300,300
  600 MT=0
      LL1=3
      RETURN
C++++++++OPTION 7,PRINTS ERGOMETER VALUES,WITHOUT RUN
  604 X=QA/FT
      Y=QB/FT
      WRITE(KL,607) J3,ND,RLACT,X,Y,PC,DVENT,RRATE,HRATE
  607 format(1X,I3,1H.,I2,' LACT=',F4.1,' VO2=',F6.0,' VCO2=',F6.0,'  R
     XQ=',F5.2,' VE=',F5.1,' AF=',F4.1,' HR=',F4.0)
      GO TO 585
  610 WRITE (KL,620) T
  620 format(1X,10F7.2)
      if(LL1-2) 470,300,300
C---------- OPTION '0' IS SAME AS '2.CONTINUE' WITH PRINTOUT SUPPRESSED
  625 NPRT=0
      GO TO 635
C OPTION '2.CONTINUE' (WITH OUTPUT)
  630 NPRT=1
  635 if(NB.EQ.1) NB=0
C.........
      NREPT=NA
      RETURN
C+++++++++++++++CREATING PLOTFILE:KPLOT
C 636 X=QA/FT
C     Y=QB/FT
C     WRITE (KPLOT,637) J3,ND,RLACT,X,Y,DVENT,RRATE,PC,COADJ
C 637 format(I3,1H.,I2,F4.1,2F6.0,F5.1,F4.1,F5.2,F5.1)
C     WRITE (KWVT,638) CATLIV,CATCID,CATMUS,AFBR1,AFBR2,PROD,TO2PR
C 638 format(7F8.4)
C     RETURN
  640 if(NW2.GT.19) GO TO 660
      WRITE (KT,650)
  650 format(' 1.CHANGE VALUES, 2.NAT/ART VENT, 3.STORE/BKTRK, 4.RUN CH
     XANGE, 5.PRESETS')
      NW2=0
  660 CALL NXTWD (3,XXX,NNN,1,5)
      if(NNN.NE.5) NW=0
      GO TO (930,820,920,670,440), NNN
  670 if(NW2.GT.19) GO TO 690
C-------- GIVES CURRENT VALUES BEFORE ASKING FOR NEW ONES
      NNN=NA*INT(60.*FT)
      WRITE (KT,680) NNN
  680 format(' TYPE NO.OF SECONDS FOR RUN(1800 MAX.- CURRENT VALUE=',I4
     X,')')
  690 CALL NXTWD (7,XT,NNN,2,1800)
      if(NW2.GT.19) GO TO 710
      XXX=60.*FT
      WRITE (KT,700) XXX
  700 format(' TYPE ITERATION INTERVAL IN SECS.(10 MAX.- CURRENT VALUE=
     X',F4.1,')')
C........
  710 CALL NXTWD (12,XXX,NNN,1,10)
      FT=XXX/60.+.000001
      NA=INT(XT/XXX)
      if(NW2.GT.19) GO TO 730
      WRITE (KT,720)
  720 format(' DO YOU WANT 1.ALL, 2.EVERY 6TH, OR 3.EVERY 3OTH VALUE PR
     XINTED')
  730 CALL NXTWD (11,XXX,ISPAR,1,3)
      if(NW2.GT.19) GO TO 750
      WRITE (KT,740)
C THIS USE OF NXTWD ALLOWS A STRING OF 1 TO 8 NUMBERS TO
C BE FED INTO ARRAY(NE)
  740 format(' DO YOU WANT..1.GRAPHS + TEXT, 2.GRAPHS ONLY, 3.SELECTED
     XVALUES')
  750 CALL NXTWD (5,XXX,NC,1,4)
      MT=1
      GO TO (470,810,760,470), NC
  760 if(NW2.GT.19) GO TO 780
      WRITE (KT,770)
  770 format(' TYPE UP TO 8 NOS. - 69 IS STANDARD')
      NW2=0
C-------- ORIGINAL VERSION DID NOT ALLOW CHANGE OF 8TH COLUMN!
  780 NEOF=9
C........
      NL=0
      JKL=1
  790 CALL NXTWD (6,XXX,NNN,1,120)
      NW2=NW2+1
      NL=NL+1
      if(JKL.EQ.0) GO TO 800
      if(NEOF.EQ.0) GO TO 470
      NE(NL)=NNN
      GO TO 790
  800 NE(NL)=NNN
  810 MT=0
      GO TO 470
  820 if(NW2.GT.19) GO TO 840
      WRITE (KT,830)
  830 format(' 1.GIVE ARTIFICIAL, 2.RETURN TO NATURAL VENTILATION')
  840 CALL NXTWD (7,XXX,NARTI,1,2)
      NARTI=NARTI-1
      if(NARTI) 850,850,841
  841 PEEP=0.
      WRITE (KL,842)
  842 format(' *** NATURAL VENTILATION')
      GO TO 470
  850 if(NW2.GT.19) GO TO 870
C-------- TIDY UP formatSTATEMENTS
      WRITE (KT,860)
  860 format(' GIVE VENTILATION RATE IN CYCLES/MIN')
  870 CALL NXTWD (7,RRATE,NNN,0,200)
      if(RRATE.LE..001) RRATE=.001
      if(NW2.GT.19) GO TO 890
      WRITE (KT,880)
  880 format(' NOW TIDAL VOLUME IN ML')
C........
  890 CALL NXTWD (8,TIDVL,NNN,0,5000)
      if(TIDVL.LE..001) TIDVL=.001
      NW=0
      if(NW2.GT.19) GO TO 910
      WRITE (KT,900)
  900 format(' POSITIVE END EXPIRATORY PRESSURE - TYPE EITHER *0*',/,'
     XOR NUMBER OF CM WATER (UP TO 15)')
  910 CALL NXTWD (16,PEEP,NNN,0,15)
      WRITE (KL,912) RRATE,TIDVL,PEEP
  912 format(' *** ART.VENT. AT',F4.0,'/MIN.,',F6.0,'ML TID.VOL., AND',
     XF4.0,'CM PEEP')
      GO TO 470
C-------- ADD LL4 TO STOP INCORRECT OUTPUT AFTER BACKTRACK
  920 CALL DUMP (LL1,LL4)
C........
      NB=0
      GO TO 470
  930 if(NW2.GT.19) GO TO 950
      WRITE (KT,940)
  940 format(' TYPE NUMBER OF FACTORS (1-30) TO CHANGE, OR 100 FOR BAG
     XEXPTS., ETC.')
      NW2=0
  950 NEOF=10
      NL=0
      KYY=-1
      JKL=1
  960 CALL NXTWD (9,XXX,NNN,1,120)
      if(NNN.EQ.100) GO TO 1100
      KYY=KYY+1
      NW2=NW2+1
      NL=NL+1
      if(JKL.EQ.0) GO TO 980
      if(NEOF.EQ.0) GO TO 990
      IANS(NL)=NNN
C-------- EXTRA SUBROUTINE CALLS AND REARRANGEMENT FOR CHECK + COMMT
C*** THE NEXT 15 LINES ADD 2 NEW SUBROUTINES (CHECK AND COMMT) TO
C THE ORIGINAL VERSION. THESE ADD CONVENIENCE BUT ARE NOT ESSENTIAL.
      GO TO 960
  980 IANS(NL)=NNN
      KYY=KYY+1
  990 if(NW2.GT.19) GO TO 1000
      NW2=0
 1000 DO 1040 IJ=1,KYY
      I=IANS(IJ)
      if(NW2.GT.19) GO TO 1020
      if(I.NE.4) GO TO 1008
      WRITE (KT,1005) WRATE
 1005 format(' EXTERNAL LOAD=',F7.1,' SPECIFY NEW VALUE')
      GO TO 1020
 1008 WRITE (KT,1010) I,T(I)
 1010 format(' FACTOR ',I3,' (CURRENT VALUE=',F7.1,'), SPECIFY NEW VALU
     XE')
 1020 CALL CHECK (I,NLOW,NHIGH)
      CALL NXTWD (10,XXX,NNN,NLOW,NHIGH)
C-------- ALLOWS NO ENTRY (NNN SET TO -999) TO LEAVE
C         PREVIOUS VALUE, UNCHANGED
      if(NNN.EQ.-999) GO TO 1040
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C   CALCULATIONS TO CONVERT WATTS EXTERNAL LOAD TO
C    PER CENT INTERNAL METABOLISM
C
      if(I.NE.4) GO TO 1027
      WRITE (KT,1023) XXX,WRATE
 1023 format(' EXTERNAL LOAD IN WATTS=',F7.1,' ,PREVIOUSLY=',F7.1)
      WRATE=XXX
      CALL FUNCTN (WRATE,EFFIC,FUN3,10)
      XXX=(WRATE*1.19*100)/EFFIC
      if( WRATE.LT.3.0) XXX=100.
 1027 CONTINUE
C
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
      WRITE (KT,1030) I,XXX,T(I)
 1030 format(' FACTOR ',I3,' =',F7.1,' (PREVIOUSLY =',F7.1,')')
      if(NW2.LT.19) CALL COMMT (I,XXX)
C........ END OF CHANGES AND NEW SUBROUTINE CALLS
      T(I)=XXX
      if(T(I).EQ..0) T(I)=.00000001
 1040 CONTINUE
 1050 NW=0
      REFLV=VLUNG
      GO TO 470
 1100 CALL BAGER (1,X,Y,PPH,SIMLT)
      GO TO 1050
C CHECK FOR VARIOUS SYMPTOMS
C-------- ADD LL4 TO STOP INCORRECT OUTPUT AFTER BACKTRACK
 1110 if(NB.EQ.2) CALL DUMP (LL1,LL4)
C........
      CALL SYMPT (SIMLT)
      GO TO 470
C--------- END OF PROGRAM MESSAGES MOVED TO MACPUF
 1120 LL1=-9999
      RETURN
C..........
      END
C
C*****************************************************************
C
      SUBROUTINE DEATH (LL1,LL5)
C THIS SUBROUTINE CHECKS FOR 1.ERRORS, 2.DEATH, 3.INTOLERABLE ACIDOSIS
        DIMENSION MM(6)
C------ CHANGE IN COMMON BLOCK
        COMMON KT,KL,NTAB(102),T(95)
C.......
        EQUIVALENCE (PD,T(4)),(TPH,T(59)),(PG,T(75)),(BUBBL,T(83))
        DATA MM/60,87,88,95,41,42/
      if(LL5) 90,140,140
C ERRORS DIAGNOSIS
  90  DO 100 I=1,6
      LL5=MM(I)
      IF(T(LL5)-.001) 110,100,100
  100 CONTINUE
      LL5=0
  110 WRITE (KT,120) LL5
  120 format(' *** FACTOR ',I2,' HAS GONE NEGATIVE - TIME INTERVAL PROB
     XABLY TOO LONG')
      LL1=3
      GO TO 360
C CHECK FOR LETHAL CONDITIONS
  140 LL1=1
      if(PG) 145,150,150
  145 PG=0.
  150 if(PG-7.) 160,160,190
  160 if(TPH-6.63) 210,210,170
  170 if(TPH-7.8) 180,180,230
  180 if(BUBBL-280.) 300,300,240
  190 WRITE (KL,200)
  200 format(/,' ANOXAEMIA HAS BEEN SEVERE AND IRRECOVERABLE')
      GO TO 270
  210 WRITE (KL,220)
  220 format(/,' TISSUE PH HAS FALLEN TO A LETHALLY LOW LEVEL')
      GO TO 270
  230 WRITE (KL,260)
      GO TO 270
  240 WRITE (KL,250)
  250 format(/,' THE BRAIN IS IRRECOVERABLY FULL OF GAS BUBBLES')
  260 format(/,' TISSUE PH HAS RISEN TO A LETHALLY HIGH LEVEL')
  270 WRITE (KT,280)
  280 format(/,' YOUR PATIENT HAS DIED...........')
  290 LL1=2
      GO TO 360
C CHECK FOR INTOLERABLE ACIDOSIS DURING EXERCISE
  300 IF(PD-290.) 360,310,310
  310 IF(TPH-7.1) 320,320,360
  320 WRITE (KL,350)
  350 format(' ....I CAN*T GO ON....')
  360 RETURN
      END
C
C*****************************************************************
C+
C+++++++++++++++++++++ SUBROUTINE DELAY CHANGED FOR DELAY CHANGE
      SUBROUTINE DELAY
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,NW
        COMMON NFLAG,J3,ISPAR,NA,NB,NC,ND,NE(8)
        COMMON NARTI,MT,K2,K4,INDEX
        COMMON T1(30),VO2CT,T2(29),VC2CT,T3(19),FT,T4(4),VC3MT,T5(6),
     X COADJ,T6(3),TC2PR,T7(23),TDLAY(80)
C DELAY LINE FOR CIRCULATION OF GASES ETC
      NFT=IFIX(32.2*FT*SQRT(COADJ))
      if(NFT-20) 110,110,100
  100 NFT=20
  110 M=INDEX+NFT-1
      DO 140 I=INDEX,M
      N=I
      if(N-20) 130,130,120
  120 N=N-20
  130 TDLAY(N)=VO2CT
      TDLAY(N+20)=VC2CT
      TDLAY(N+40)=VC3MT
  140 TDLAY(N+60)=TC2PR
      N=INDEX+NFT
      if(N-20) 160,160,150
  150 N=N-20
  160 VO2CT=TDLAY(N)
      VC2CT=TDLAY(N+20)
      VC3MT=TDLAY(N+40)
      TC2PR=TDLAY(N+60)
      INDEX=N
      RETURN
      END
C-------- ADD LL4 TO STOP INCORRECT OUTPUT AFTER BACKTRACK
C
C******************************************************************
C
      SUBROUTINE DUMP (LL1,LL4)
C........
C THIS S/R ALLOWS STORAGE AND BACKTRACKING
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,NW
C++++++++++++++++++  COMMON CHANGED FOR CHANGE TDLAY
        COMMON NTAB(20),T(200)
        COMMON NDUMP(20),TDUMP(160)
      if(LL1.GT.9) GO TO 140
      if(NTAB(5).EQ.2) GO TO 120
      if(LL1.GT.1) GO TO 170
      if(NW2.GT.19) GO TO 110
      WRITE (KT,100)
  100 format(' DO YOU WANT TO 1.STORE PRESENT STATE, 2.BACKTRACK TO LAS
     XT STORED STATE')
  110 CALL NXTWD (14,XXX,NNN,1,2)
      GO TO (120,170), NNN
  120 WRITE (KL,130)
  130 format(' STORED AT THIS POINT ************')
  140 DO 150 I=2,20
  150 NDUMP(I)=NTAB(I)
      DO 160 I=1,160
  160 TDUMP(I)=T(I)
      RETURN
  170 WRITE (KL,180)
  180 format(' ************ BACKTRACK TO LAST STORE')
      DO 190 I=2,20
  190 NTAB(I)=NDUMP(I)
      DO 200 I=1,160
  200 T(I)=TDUMP(I)
      LL1=1
C-------- RESET OUTPUT SUPPRESSION INDEX AFTER BACKTRACK
      LL4=0
C........
      RETURN
      END
C
C******************************************************************
C
      SUBROUTINE GASES (PO2,PC2,O2CON,C2CON,PH,SAT)
C THIS SR TAKES ANY VALUES OF PO2,PCO2,AND PH AND WORKS
C OUT O2 CONTENT AND CO2 CONTENT(AND SAT.OF O2) AND
C RETURNS RESULTS TO CALLING ROUTINE. MATHS IS THAT OF
C KELMAN WHO HAS PUBLISHED THESE COMPUTER ROUTINES
C TEMPERATURE,HAEMOGLOBIN AND PCV ALSO ALLOWED FOR
C .....REFER TO KELMAN'S PAPERS FOR DETAILS
C---------- CHANGE IN COMMON BLOCK SIZE
        COMMON NTAB(104)
C.......
        COMMON Y1(13),TEMP,Y2(3),HB,PCV,Y3(23),DPH
C ABOVE CONTAINS ALL NECESSARY VARIABLES WHICH,TO SAVE SPACE,
C ARE REFERRED BY ARRAY NUMBERS RATHER THAN IDENT.LETTERS.
C SEE MAIN PROGRAMME FOR NAMES OF VARIABLES IN ARRAY Y()
        DATA A1, A2, A3, A4, A5, A6, A7/-8.532229E3, 2.121401E3,
     X    -6.707399E1, 9.359609E5, -3.134626E4, 2.396167E3, -6.710441E1/
      X=PO2*10.**(.4*(PH-DPH)+.024*(37.-TEMP)+.026057669*(ALOG(40./
     XPC2)))
      if(X-.01) 100,110,110
  100 X=.01
  110 if(X-10.) 120,130,130
  120 SAT=(.003683+.000584*X)*X
      GO TO 140
  130 SAT=(X*(X*(X*(X+A3)+A2)+A1))/(X*(X*(X*(X+A7)+A6)+A5)+A4)
  140 O2CON=HB*SAT*1.34+.003*PO2
      P=7.4-PH
      PK=6.086+P*.042+(38.-TEMP)*(.00472+.00139*P)
      T=37.-TEMP
      SOL=.0307+(.00057+.00002*T)*T
      DOX=.590+(.2913-.0844*P)*P
      DR=.664+(.2275-.0938*P)*P
      T=DOX+(DR-DOX)*(1.-SAT)
      CP=SOL*PC2*(1.+10.**(PH-PK))
      CC=T*CP
      H=PCV*.01
      C2CON=(CC*H+(1.-H)*CP)*2.22
      RETURN
      END
C
C******************************************************************
C
      SUBROUTINE GSINV (PO2,PC2,O2CON,C2CON,PH,SAT)
C THIS SR REVERSES GASES AND BY AN OPTIMISED PROCESS OF
C SUCCESSIVE APPROXIMATION USES O2 AND CO2 CONTENTS TO
C COMPUTE THE RESPECTIVE PARTIAL PRESSURES
C---------- CHANGE IN COMMON BLOCK SIZE
        COMMON NTAB(104)
C.......
        COMMON Y1(13),TEMP,Y2(3),HB,PCV,Y3(23),DPH,Y4(40),PK
      DATA ERR,FACT/.01,1./
C FLAGS ICH1/3 SIGNIFY STATES IN APPROXIMATION OF PO2,
C ICH2/4= SIMILARLY FOR PCO2
C ICH1=0 MEANS PO2 IS WELL ENOUGH APPROXIMATED WITH ABS.ACCURACY
C 'ERR' IN O2CON
C ICH1=1 MEANS A BRACKETING PROCEDURE TO ESTABLISH BOUNDS ON THE
C PO2 VALUE IS IN PROGRESS
C ICH3=1 A BRACKET HAS BEEN ESTABLISHED AND A LINEAR INTERPOLATION
C MADE FOR NEXT ESTIMATE OF PO2
C ICH3=0 NO BRACKET AT THIS TIME
C SET MAGNITUDE INITIAL STEP LENGTHS FOR BRACKETING PROCEDURE TO FIND
C BOUNDS WITHIN WHICH PO2 AND PCO2 MUST LIE
C SET INITIAL FLAG VALUES AS ifCURRENT VALUES FOR PO2 AND PCO2
C WERE AS INTERPOLATED AT A BRACKET
      D1Z=2.
      D2Z=2.
      ICH1=1
      ICH2=1
      ICH3=1
      ICH4=1
C START SEARCH FROM CURRENT ESTIMATES OF PO2 AND PCO2
  100 CALL GASES(PO2,PC2,X,Y,PH,SAT)
C XX2/YY2 STORE DISCREPANCY BETWEEN KNOWN CONTENTS AND VALUES
C COMPUTED USING CURRENT GUESSES OF PRESSURES
      XX2=X-O2CON
      YY2=Y-C2CON
C AVOID ERROR IN SIGN FUNCTION BELOW
      IF(XX2) 120,110,120
  110 XX2=.001
  120 IF(YY2) 140,130,140
  130 YY2=.001
C XP2/YP2 STORE PRESSURE ESTIMATES CORRESPONDING TO DISCREPANCIES
C XX2/YY2. THESE ARE ALL USED IN INTERPOLATION PROCEDURE BELOW.
C FORM NEW SEARCH VECTORS D1/D2, AFTER BRACKETING AND
C INTERPOLATION, ACCORDING TO SIGN OF DISCREPANCIES XX2/YY2.
C RESET ICH3/ICH4 TO ZERO
  140 XP2=PO2
      YP2=PC2
      IF(ICH3-1)160,150,160
  150 ICH3=0
      D1=SIGN(D1Z,-XX2)
  160 IF(ICH4-1)210,170,210
  170 ICH4=0
      D2=SIGN(D2Z,-YY2)
C TEST FOR CONVERGENCE OF CALCULATED AND GIVEN CONTENTS.  SET FLAGS
C ICH1/ICH2 TO ZERO ifCONTENTS APPROXIMATED WELL ENOUGH
      IF(ABS(XX2)-ERR) 180,180,190
  180 ICH1=0
  190 IF(ABS(YY2)-ERR) 200,200,210
  200 ICH2=0
C FINISH ifBOTH CONTENTS APPROXIMATED WELL ENOUGH
      IF(ICH1+ICH2)450,450,210
C COMPUTE TRIAL INCREMENT DS FOR PO2 ENFORCING A LIMIT OF
C -PO2*.75 ifIT IS NEGATIVE. (STOP NEGATIVE TRIAL
C VALUES AND SMOOTH APPROACH TO A SOLUTION).
  210 DS=D1*ICH1
      X=PO2+DS-PO2*.25
      if(X) 220,230,230
  220 DS=-PO2*.75
  230 PO2=PO2+DS
C COMPUTE TRIAL INCREMENT OF PCO2 AS FOR PO2 ABOVE
      DS=D2*ICH2
      X=PC2+DS-PC2*.25
      if(X) 240,250,250
  240 DS=-PC2*.75
  250 PC2=PC2+DS
C ENFORCE LOWER BOUND ON PO2/PCO2
      IF(PO2-.1) 260,270,270
  260 PO2=.1
  270 IF(PC2-.1)280,290,290
  280 PC2=.1
C COMPUTE CONTENTS WITH TRIAL INCREMENTS MADE TO PO2/PCO2
  290 CALL GASES(PO2,PC2,X,Y,PH,SAT)
C SAVE LAST BUT ONE PAIRS OF VALUES PO2/O2CON DISCREPANCY IN
C XX1/XP1, SIMILARLY FOR PC2/C2CON DISCREPANCY IN YY1/YP1.
C THEN PLACE LATEST PAIRS OF VALUES IN XX2/XP2, YY2/YP2 AS BEFORE
      XX1=XX2
      XX2=X-O2CON
      XP1=XP2
      XP2=PO2
      YY1=YY2
      YY2=Y-C2CON
      YP1=YP2
      YP2=PC2
C FIRST LOOK AT DISCREPANCY IN O2CON (ICH1=0). ifWITHIN LIMIT
C 'ERR' ACCEPT VALUES OF PO2 AND LOOK AT C2CON
      IF(ABS(XX2)-ERR) 300,300,310
  300 ICH1=0
      GOTO 360
C ifO2CON DISCREPANCY STILL TOO HIGH TEST WHETHER TRIAL PO2 HAS
C OVERSHOT THE CORRECT SOLUTION
  310 ICH1=1
      IF(XX2*D1) 320,360,350
C ifNOT OVERSHOT, SOLUTION LIES FURTHER ALONG DIRECTION OF TRIAL
C INCREMENT.  COMPUTE A NEW TRIAL INCREMENT BASED ON LAST 2 PAIRS
C OF CONTENTS/PRESSURES VALUES. FACTOR 'FACT' WAS USED IN
C IN OPTIMISING THE ALGORITHM IN PRACTICE
  320 IF(XP2-XP1) 340,330,340
  330 D1=SIGN(D1Z,-XX2)
      GO TO 360
  340 D1=(XP2-XP1)*ABS(XX2)/(FACT*ABS(XX2-XX1))
      GO TO 360
C ifOVERSHOT, (I.E. BRACKET FOUND ON PO2) LINEARLY INTERPOLATE
C USING LAST 2 PAIRS OF PRESSURES/CONTENTS VALUES TO GET NEW TRIAL
C VALUE FOR PO2. SET ICH3=1 TO INDICATE BRACKETED INTERPOLATED
C VALUE FOR NEW SEARCH TO BE INITIATED AT STATEMENT 100. REDUCE
C INITIAL SEARCH VECTOR TO AID CONVERGENCE
  350 ICH3=1
      PO2=XP1+(XP2-XP1)*ABS(XX1)/(ABS(XX2)+ABS(XX1))
      D1Z=D1Z/2.
C NOW REPEAT ABOVE PROCEDURE FOR DISCREPANCY IN C2CON
  360 IF(ABS(YY2)-ERR) 370,370,380
  370 ICH2=0
      GO TO 430
  380 ICH2=1
      IF(YY2*D2) 390,430,420
C KEEP GOING
  390 IF(YP2-YP1) 410,400,410
  400 D2=SIGN(D2Z,-YY2)
      GO TO 430
  410 D2=(YP2-YP1)*ABS(YY2)/(FACT*ABS(YY2-YY1))
      GO TO 430
C BRACKET FOUND
  420 ICH4=1
      PC2=YP1+(YP2-YP1)*ABS(YY1)/(ABS(YY1)+ABS(YY2))
      D2Z=D2Z/2.
C FINISH ifBOTH O2CON AND C2CON WELL ENOUGH APPROXIMATED.  ifEITHER
C PO2 OR PCO2 SEARCH IS AT A BRACKET ESTABLISH NEW SEARCH AT
C STATEMENT 100.  ELSE, ifBOTH ARE CONTINUING ALONG PREVIOUS
C DIRECTIONS OF SEARCH PROCEED FROM STATEMENT 210
  430 IF(ICH1+ICH2) 450,450,440
  440 IF(ICH3+ICH4-1) 210,100,100
  450 RETURN
      END
C-------- NEW PARAMETER TO INTERFACE WITH MCAID DRIVER
C
C******************************************************************
C
      SUBROUTINE MINIT (MCAID,LL1,LL3,LL4,NREPT,SIMLT)
C.........
C INITIALIZE ALL VALUES AND INDICES FOR A NEW SUBJECT
      DIMENSION REFER(120)
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,NW
        COMMON NFLAG,J3,ISPAR,NA,NB,NC,ND,NE(8)
        COMMON NARTI,MT,K2,K4,INDEX
        COMMON T(120),TDLAY(80)
C CONSTANTS FOR INTIALIZING A NEW SUBJECT
      DATA REFER/20.93,.03,2*100.,2*.0,3000.,5.,3.,100.,
     X 2*100.,760.,37.,.8,13.38,12.,14.8,45.,3000.,
     X 0.,0.,3.8,100.,33.,.4,35.,0.,5.,0.,
     X 14.56,100.,7.4,7.37,4.26,7.33,2*0.,348.1,143.3,
     X 101.9,39.75,7.40,0.,28.89,52.8,461.9,12.82,19.54,1540.,
     X 2*5.92,47.25,19.66,14.47,51.4,10.05,56.62,7.37,23.82,
     X 51.33,195.44,473.5,10.99,1987.,18.06,677.,51.94,.80,129.2,
     X 3000.,94.18,240.,39.9,0.,97.13,-10.,47.35,33.29,2.36,
     X .0166667,4.6,0.,45.43,318.,71.55,2*25.48,34.63,.99,
     X 22.7,1.,5.01,19.54,178.4,40.13,45.43,437.,710.8,0.,
     X 47.35,76.07,571.1,4.,564.,.73,0.,7.26,70.,70.,
     X -.03,967.,41.61,3*0.,1.,178.,70.,40./
C---------- SEVERAL CHANGES INVOLVING INTERFACE WITH MCAID DRIVER
      if(MCAID) 10,10,110
   10 WRITE(KL,100)
  100 format(//,' --- NEW SUBJECT ---',/)
  110 if(LL1.LT.10) GO TO 200
      T(81)=.166667
      if(MCAID) 115,115,118
  115 CALL QUERY (LL3)
      NW2=0
  118 CALL NXTWD (7,XXX,LL3,0,2)
C ITRIG(73) CONTROLS PRINT OUT OF THE FIRST 6 FACTORS AT THE END OF RUN
C OTHER INDICES MOSTLY CONCERNED WITH INTERACTIVE DIALOGUE(S/R NXTWD)
      if(MCAID.EQ.1) GO TO 170
      if(LL3-1) 150,140,130
  130 ITRIG(73)=-5
  140 CALL QUERY (LL3)
C......
      GO TO 160
  150 NC=3
  160 if(NW2.GT.19) GO TO 170
      WRITE (KT,165)
  165 FORMAT(' TO USE S.I. UNITS(KPA) TYPE 1, FOR MM HG TYPE 2',/)
      NW2=0
  170 CALL NXTWD (7,XXX,NNN,1,2)
      SIMLT=1.
      IF(NNN.EQ.1) SIMLT=.1332
  200 NW=1
C------ MCAID USE FORCES ITRIG(73)
      if(MCAID.EQ.1) ITRIG(73)=3
C....
      NARTI=1
      J3=0
      MT=1
      K2=0
      K4=0
      if(NC-3) 250,220,250
  220 if(LL1-10) 260,230,260
  230 CALL QUERY (18)
  260 WRITE (KL,270) NE
  270 format(10H MINS     ,7(1H(,I3,1H),3X),1H(,I3,1H))
  250 INDEX=1
      NREPT=1
      X=T(81)
      DO 320 I=1,120
  320 T(I)=REFER(I)
C++++++++++++++++++++ CHANGED FOR DELAY CHANGE
      DO 330 I=1,20
      TDLAY(I)=T(31)
      TDLAY(I+20)=T(61)
      TDLAY(I+40)=T(86)
  330 TDLAY(I+60)=T(97)
      T(13)=T(13)*SIMLT
      if(LL1.LT.10) GO TO 240
C-------- ADD LL4 TO STOP INCORRECT OUTPUT AFTER BACKTRACK
      CALL DUMP (LL1,LL4)
C........
      LL1=1
C-------- RESETS TIME SCLAE, UNLESS IN RESEARCH MODE (NC=3)
240   if(NC.NE.3) GO TO 340
      T(81)=X
340   T(77)=-T(81)*60.
C-------- BETTER INITIAL VALUE FOR LL4
      LL4=29
C........
      RETURN
      END
C
C******************************************************************
C
      SUBROUTINE NXTWD (LL3,XXX,NNN,IMIN,IMAX)
C THIS S/R AND FUNCTIONS VALUE AND V1 ALLOW NUMBERS TO BE ENTERED IN
C FREE formatAND RETRIEVED IN STANDARD REAL OR INTEGER FORM, OR FED
C INTO ARRAYS ifNEEDED OR, if*Q* IS TYPED, REFERENCE IS MADE TO
C S/R QUERY TO EXPLAIN THE MEANING OF THE QUESTION. OTHERWISE
C THIS SR.AND FUNCTIONS ARE SELF EXPLANATORY
        DIMENSION ICHAR(18),ITEM(20)
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,NW
        DATA ICHAR/1H ,1H1,1H2,1H3,1H4,1H5,1H6,1H7,1H8,1H9,1H0,
     X             1H.,1H-,1H/,1HB,1HF,1HU,1HQ/
      XMIN=IMIN
      XMAX=IMAX
  100 DO 110 J=1,20
      ITEM(J)=1
  110 CONTINUE
      if(NW2.GE.1) GO TO 200
      NREF=NEOF
      DO 120 J=1,72
  120 ITRIG(J)=ICHAR(1)
      IL=1
C*** THE FOLLOWING (OPTIONAL) 2 STATEMENTS MAY BE USED TO
C RETURN THE CURSOR TO THE START OF THE LINE, ifTHE COMPUTER
C DOESN*T DO IT, THEREBY ALLOWING THE INSERTION OF A LONG
C STRING OF OPERATING INSTRUCTIONS ALONG THE LINE OF INPUT
      WRITE (KT,130)
  130 format(1X,'?')
      READ (INI,140) (ITRIG(IM),IM=1,72)
  140 format(72A1)
  150 if(ITRIG(1).NE.ICHAR(1).AND.ITRIG(1).NE.ICHAR(14)) GO TO 190
C-------- EXTRA STATEMENT MAKES 'NO ENTRY' KEEP DEFAULT VALUES
C         FOR PARAMETERS
      if(LL3.EQ.10) GO TO 388
C........
  160 WRITE (KT,170)
  170 format(' A NUMBER MUST BE ENTERED')
      GO TO 240
  180 CALL QUERY (LL3)
      GO TO 240
  190 if(ITRIG(IL).EQ.ICHAR(18)) GO TO 180
      NW1=IL
  200 L=0
      DO 280 IL=NW1,72
      DO 210 J=1,14
      if(ITRIG(IL).EQ.ICHAR(J)) GO TO 260
  210 CONTINUE
      if((ITRIG(IL).EQ.ICHAR(15).OR.ITRIG(IL).EQ.ICHAR(16)).AND.ITRIG(I
     XL+1).EQ.ICHAR(17)) GO TO 350
  220 WRITE (KT,230)
  230 format(' ONLY NUMBERS ARE ACCEPTABLE')
  240 WRITE (KT,250)
  250 format(' PLEASE TRY AGAIN')
      NW2=0
      NEOF=NREF
      GO TO 100
  260 if(J.NE.1.AND.J.NE.14) GO TO 270
      if(L) 280,280,290
  270 L=L+1
      if(L.EQ.20) GO TO 370
      ITEM(L)=J
      if(J.EQ.1) GO TO 290
  280 CONTINUE
      IL=72
      if(NW2.GT.19) GO TO 160
  290 NW1=IL+1
C DETECT SLASH / DELIMITER
      if(J.EQ.14) GO TO 340
      if(J.EQ.1.AND.NEOF.LE.1) NW2=0
      if(J.EQ.1.AND.ITRIG(NW1).EQ.ICHAR(1).AND.
     X NW2.GT.19) GO TO 390
  300 if(NW1.GE.72) GO TO 330
      XXX=VALUE(ITEM)
C-------- REARRANGES, ECONOMISES, AND ALLOWS 'NO ENTRY' TO RETAIN
C         PREVIOUS VALUES, BY RETURNING -999 AS ARGUMENT NNN
      NNN=INT(XXX)
      if(NNN.EQ.-999) GO TO 320
      if(((XXX-XMIN)*(XMAX-XXX)).LT.0.) GO TO 370
C........
  320 NEOF=NEOF-1
      RETURN
  330 NEOF=1
      NW2=0
      GO TO 320
  340 NW2=20
      JKL=0
      NEOF=1
      GO TO 300
  350 WRITE (KT,360)
  360 format(' DON*T USE RUDE WORDS')
      GO TO 220
C-------- MORE INFORMATIVE ERROR MESSAGE; INSERT '-999' ifNO ENTRY MADE
C         AND PARAMETER LL3=10
  370 WRITE (KT,380) IMIN,IMAX
  380 format(' IT HAS TO BE BETWEEN',I7,' AND',I6)
      GO TO 240
  388 ITEM(1)=13
      DO 389 J=2,4
389   ITEM(J)=10
      NW1=1
C........
  390 JKL=0
      NW2=0
      GO TO 300
      END
      REAL FUNCTION VALUE(ITEM)
      INTEGER ITEM(20)
      VALUE=0.
      I=1
      VALUE=V1(ITEM,I)
      if((ITEM(I).EQ.1).OR.(I.GE.20)) RETURN
      I=I+1
      VALUE=VALUE*(10.**V1(ITEM,I))
      RETURN
      END
      REAL FUNCTION V1(ITEM,I)
      DIMENSION DIGIT(13)
      INTEGER ITEM(20)
      DATA DIGIT/0.,1.,2.,3.,4.,5.,6.,7.,8.,9.,0.,0.,-1./
      S=1.
      V1=0.
      P=0.
      NDOT=0
  100 if((ITEM(I).EQ.1).OR.(I.GE.20)) GO TO 150
      if(ITEM(I).EQ.12) GO TO 120
      if(ITEM(I).EQ.13) GO TO 130
      if(NDOT.EQ.1) GO TO 110
      IZ=ITEM(I)
      V1=(V1*10.+DIGIT(IZ))
      GO TO 140
  110 P=P+1.
      IZ=ITEM(I)
      V1=(V1+(DIGIT(IZ)/(10.**P)))
      GO TO 140
  120 NDOT=NDOT+1
      GO TO 140
  130 IZ=ITEM(I)
      S=DIGIT(IZ)
  140 I=I+1
      GO TO 100
  150 V1=V1*S
      RETURN
      END
C
C******************************************************************
C
      SUBROUTINE QUERY (LL3)
C THIS DOES EXPLANATIONS OF QUESTIONS, AND IS ALSO USED WHEN
C CALLING UP MODEL. LL3 IS ALSO 1ST ARG. OF S/R NXTWD, AND DETERMINES
C OUTPUT TEXT FOR START, AND QUERY CALLS.
        COMMON KT,KL,INI
      GO TO (170,140,260,320,280,300,320,320,360,380,200,340,320,220,240
     X,400,100,120), LL3
  100 WRITE (KT,110)
C*** LOCAL ARRANGEMENTS
  110 format(' TO PROCEED TYPE 1 THEN PRESS RETURN KEY,',/
     X,' TO GET BRIEF DESCRIPTION AND INSTRUCTIONS TYPE 2 + C/R',/)
      GO TO 420
  120 WRITE (KT,130)
  130 format(' *UNLESS CHANGED LATER, COLUMNS REFER AS FOLLOWS...FACTOR
     X NUMBERS BELOW',/,10X,'EXP.RQ  ART.PH   TOT-VENT-ALV    HCO3  ALV.
     XPO2   PO2-ART-PCO2',/)
      GO TO 420
  140 WRITE (KT,150)
  150 format(/,' MACPUF IS A MODEL OF THE HUMAN RESPIRATORY SYSTEM DESI
     XGNED AT MCMASTER',/,' UNIVERSITY MEDICAL SCHOOL, CANADA AND ST.BAR
     XTHOLOMEWS HOSPITAL',/,' MEDICAL COLLEGE, ENGLAND, BY DR.C.J.DICKIN
     XSON, DR.E.J.M.CAMPBELL,',/,' DR.A.S.REBUCK, DR.N.L.JONES, DR.D.ING
     XRAM AND DR.K.AHMED.',/,' HE WAS CREATED TO STUDY GAS TRANSPORT AND
     X EXCHANGE.',/,' HE CONTAINS SIMULATED LUNGS, CIRCULATING BLOOD AND
     X',/,' TISSUES. INITIALLY HE BREATHES AT A RATE AND DEPTH DETERMINE
     XD',/,' BY KNOWN INFLUENCES UPON VENTILATION.',/)
      WRITE (KT,160)
  160 format(' ONCE INTO A STANDARD RUN OF 3 MINUTES (CHANGEABLE)',/,'
     XTHE DISPLAY UNIT PLOTS A VERTICAL GRAPH OF VENTILATION, RATE OF',/
     X,' BREATHING, ART.PCO2 + PO2(SYMBOLS V,F,C + O RESPECTIVELY).',//,
     X' AFTER EACH RUN YOU CAN CHANGE ANYTHING (EG. INSPIRED OXYGEN: )',
     X/,' THEN RUN ANOTHER 3 MINS AND WATCH RESULTS.')
  170 WRITE (KT,180)
C*** LOCAL ARRANGEMENTS
  180 format(/,' ifANYTHING GOES WRONG NOTE WHAT YOU DID AND INFORM ',
     X'YOUR TUTOR.',/,' ...ANY TIME YOU CAN*T UNDERSTAND AN INSTRUCTION,
     XTYPE Q(QUERY) AND PRESS *C/R*.',/,' OK, LETS GO ...')
      WRITE (KT,190)
  190 format(/,' SYMBOLS-- VV= TOT.VENT., FF=FREQ.BR., CC= ART.PCO2,'
     X,' OO= ART.PO2',/,'           **= N2 SUPERSAT.INDEX,ifPRESENT',/)
      GO TO 420
  200 WRITE (KT,210)
  210 format(' ifEVERY 6TH VALUE PRINTED COMPUTATION WILL STILL TAKE P
     XLACE',/,' AS SPECIFIED IN PREVIOUS REQUESTS..SIMILARLY FOR *30TH*'
     X)
      GO TO 420
  220 WRITE (KT,230)
  230 format(' THIS ALLOWS YOU TO STORE THE PRESENT STATE OF YOUR SUBJE
     XCT AND TO',/,' RECREATE HIM AGAIN THROUGH USE OF THIS SAME OPTION,
     X BY BACKTRACKING')
      GO TO 420
  240 WRITE (KT,250)
  250 format(' 1 IS OBVIOUS, 2 STARTS ANOTHER RUN OF STANDARD 3 MIN',/,
     X' 3 STARTS AGAIN WITH A NEW SUBJECT, 4 PRINTS A TABLE OF MOST',/,'
     X USEFUL VALUES, 5 STOPS THE PROGRAMME')
      GO TO 420
  260 WRITE (KT,270)
  270 format(' 1 IS OBVIOUS, 2 WILL RETURN TO NATURAL VENTILATION IF',/
     X,' ARTIFICIAL HAS BEEN USED AND ALLOWS YOU TO STOP VENTILATION OR
     XTO GIVE',/,' GRADED ARTIFICIAL VENTILATION, 3 ALLOWS YOU TO STORE
     XTHE',/,' PRESENT STATE BY A DUMP INSTRUCTION, AND ALSO BRING THIS
     XSTATE BACK',/,' AGAIN BY A BACKTRACK INSTRUCTION, 4 ALLOWS YOU TO'
     X,/,' ALTER LENGTH OF RUN AND ALSO GET SELECTED VALUES PRINTED TO O
     XRDER',/,' 5 GIVES PRESET PATIENTS AND INSERTION OF FUNCTION TESTS'
     X)
      GO TO 420
  280 WRITE (KT,290)
  290 format(' 1 GIVES THE GRAPH formatYOU HAVE SEEN,',/,' 2 SUPPRESSE
     XS TEXT AND VALUES AND LEAVES JUST GRAPHS,',/,' 3 WILL ALLOW COLUMN
     XS OF UP TO 8 SELECTED VARIABLES TO BE PRINTED',/,' INSTEAD.')
      GO TO 420
  300 WRITE (KT,310)
  310 format(' THIS IS THE SPECIAL TYPE OF OUTPUT. REFER TO THE ',/,' H
     XANDBOOK FOR INTERPRETATIVE CODE. *69* WILL GIVE THE FOLLOWING',/,'
     X IN COLUMNS  1.TIME, 2. EXP.R.Q., 3.ART.PH, 4.TOT.VENTLN.',/,' 5.A
     XLV.VENTLN., 6.ART.BICARB., 7.ALV.PO2 8.ART.PO2, 9.ART.PCO2',/,' OT
     XHER VARIABLES CAN BE OBTAINED BY TYPING IN A DIFFERENT NUMBER',/,'
     X OR STRING OF NUMBERS...REFER TO HANDBOOK')
      GO TO 420
  320 WRITE (KT,330)
  330 format(' ifYOU CAN*T UNDERSTAND THIS, GIVE UP ')
      GO TO 420
  340 WRITE (KT,350)
  350 format(' NORMAL IS 10, BUT FOR BIG METAB.RATES,CARDIAC OUTPUTS OR
     X VENTILATIONS,',/,' A SMALLER ITERATION INTERVAL,EG.5 SECS.WOULD B
     XE BETTER')
      GO TO 420
  360 WRITE (KT,370)
C*** LOCAL ARRANGEMENTS
  370 format(' TYPE EACH FACTOR NO. YOU WANT TO ALTER AS A STRING OF NU
     XMBERS',/,' SEPARATED BY BLANKS...RETURN AT END.',/,' TYPING 100 AL
     XLOWS YOU TO DO SPECIAL EXPERIMENTS, E.G. CLOSE',/,' GLOTTIS, EXPIR
     XE INTO OR REBREATHE FROM A BAG')
      GO TO 420
  380 WRITE (KT,390)
C*** LOCAL ARRANGEMENTS
  390 format(' TYPE IN THE VALUE IN USUAL UNITS, E.G. TO ALTER FACTOR 1
     X FROM',/,' ITS PRESENT VALUE TO 10(PERCENT OXYGEN) TYPE *10*',/,'
     XAND PRESS RETURN KEY')
      GO TO 420
  400 WRITE (KT,410)
  410 format(' POSITIVE END EXPIRED PRESSURE TENDS TO REDUCE CARDIAC OU
     XTPUT',/,' BUT CAN IMPROVE OXYGEN UPTAKE UNDER SOME CONDITIONS')
  420 RETURN
      END
C
C******************************************************************
C
      SUBROUTINE SYMPT(SIMLT)
C THIS S/R SPECIFIES VARIOUS SYMPTOMS UNDER APPROPR. CONDITIONS
        COMMON KT,KL,INI,NW1,NW2,JKL,NPRT,LDISP,KA,ITRIG(73),NEOF,NW
        COMMON NFLAG,J3,ISPAR,NA,NB,NC,ND,NE(8)
        COMMON NARTI,MT,K2,K4,INDEX
        COMMON T1(12),BARPR,T2(4),HB,T3(26),BO2PR,BC2PR,T4,RRATE,RO2CT,
     X T5,DVENT,SVENT,T6(6),TPH,T7(15),PG,T8(5),FT,CONOM,BUBBL,T9(19),
     X TN2PR
C K1-K4 CONCERNED WITH IMPROVEMENT SYMPTOMS (LOGIC IS COMPLEX)
      X=1./SIMLT
  100 K1=0
      K3=0
      if(TN2PR*X-6000.) 110,110,130
  110 if(12.5-BO2PR*X) 120,120,130
  120 if(BC2PR*X-91.) 150,150,130
  130 WRITE (KT,140)
  140 format(/,' YOUR PATIENT IS UNROUSABLE')
      K1=1
      GO TO 428
  150 if(BO2PR*X-13.9) 160,160,180
  160 WRITE (KT,170)
  170 format(/,5X,'MY EYES ARE GOING DIM')
      K1=1
  180 if(BUBBL-160.) 210,210,190
  190 WRITE (KT,200)
  200 format(/,5X,'I HAVE AWFUL PAINS IN MY LEGS')
      K1=1
      GO TO 240
  210 if(BUBBL-101.) 240,240,220
  220 WRITE (KT,230)
  230 format(/,5X,'MY SKIN IS ITCHING')
      K3=1
  240 if(TN2PR*X-4300.) 250,250,260
  250 if(BC2PR*X-80.) 280,280,260
  260 WRITE (KT,270)
  270 format(/,5X,'I AM FEELING DROWSY')
      K3=1
  280 if(NARTI) 390,390,290
  290 if(RRATE-46.) 330,330,300
  300 WRITE (KT,310)
  310 format(/,5X,'THIS....IS....IMPOSSIB... ...')
  320 K1=1
      GO TO 390
  330 if(RRATE-35.) 360,360,340
  340 WRITE (KT,350)
  350 format(/,5X,'I AM VERY SHORT OF BREATH')
      GO TO 320
  360 if(RRATE-27.) 390,390,370
  370 WRITE (KT,380)
  380 format(/,5X,'I AM RATHER SHORT OF BREATH')
      K3=1
  390 if(TPH-7.59) 420,420,400
  400 WRITE (KT,410)
  410 format(/,5X,'I AM GETTING TINGLING AND CRAMPS IN MY HANDS')
      K3=1
  420 if(TPH-7.13) 424,424,428
  424 WRITE (KT,426)
  426 format(/,5X,'I DON*T FEEL WELL AT ALL')
      K3=1
  428 if(TPH-7.08) 430,450,450
  430 WRITE (KT,440)
  440 format(/,' YOUR PATIENT IS TWITCHING')
      K1=1
  450 if(NARTI) 460,460,490
  460 X=SVENT*.9-DVENT
      if(X) 490,490,470
  470 WRITE (KT,480)
  480 format(/,' YOUR PATIENT IS FIGHTING THE VENTILATOR')
      K3=1
  490 X=1.3*HB-RO2CT
      if(X-7.) 520,500,500
  500 WRITE (KT,510)
  510 format(/,' YOUR PATIENT IS VERY BLUE')
      K1=1
      GO TO 550
  520 if(X-5.) 550,530,530
  530 WRITE (KT,540)
  540 format(/,' YOUR PATIENT IS BLUE')
      K3=1
  550 if(K1-K3) 570,570,560
  560 K3=1
  570 K5=K1+K3
      if(K2-K5) 600,600,580
  580 WRITE (KT,590)
  590 format(/,5X,'GOD BLESS YOU DOCTOR. I FEEL REALLY WELL AGAIN',/,5X
     X,'IT*S LIKE A MIRACLE',/)
      GO TO 660
  600 if(K2-K1) 630,630,610
  610 WRITE (KT,620)
  620 format(/,5X,'I FEEL BETTER BUT NOT RIGHT YET.',/,5X,'CAN*T YOU DO
     X SOMETHING ELSE FOR ME?',/)
      GO TO 660
  630 if(K4-K3) 660,660,640
  640 WRITE (KT,650)
  650 format(/,5X,'THAT*S BETTER DOCTOR ..... ',/,5X,'BUT ARE YOU GOING
     X TO DO ANY OTHER NASTY THINGS TO ME?',/)
  660 K2=K1
      K4=K3
      if(NB.NE.2) GO TO 670
C ALTER NO. OF ITERATIONS AFTER CLIN1 AND 2 SUBJECTS IN STEADY STATE
      NA=30
      if(FT.LT..1) NA=18
      NB=0
  670 RETURN
      END
C
C******************************************************************
C
      SUBROUTINE UNITS(N,SIMLT)
C TRANSFORM PRESSURE VARIABLES TO S.I. UNITS, ifNECESSARY
C SIMLT HAS VALUE OF 1 FOR MM HG, .1332 FOR SI(KPA)
C-------- MORE CORRECT ORDER OF STATEMENTS; CHANGE IN COMMON BLOCK
      DIMENSION NSI(10)
      COMMON NTAB(104),T(105)
C........
C NSI CONTAINS FACTOR NUMBERS OF ALL P.PRESS. VARIABLES FOR
C SI CONVERSION BEFORE OUTPUT DISPLAY
      DATA NSI/41,42,45,46,72,74,96,97,103,105/
      X=SIMLT
      IF(N-2) 10,5,10
   5  X=1./X
  10  DO 20 I=1,10
      J=NSI(I)
  20  T(J)=T(J)*X
      RETURN
      END
C+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C******************************************************************
C
      SUBROUTINE FUNCTN(EN,OU,FUN,NBP)
C+
C+
C THIS SUBROUTINE,CREATES AN OU=F(EN) FUNCTION OUT OF A NUMBER OF NBP
C POINTS WHICH ARE INITIALIZED IN DATASET FUN IN THE MAIN PROGRAM
C+
C+
      DIMENSION FUN(20)
      NL0=NBP-1
      NL1=NBP*2-1
      NL2=NBP*2
      if(EN.LT.FUN(1)) GO TO 30
      if(EN.GE.FUN(NL1)) GO TO 40
      DO 10 I=1,NL0
         L = 2*I-1
         if(EN.GE.FUN(L) .AND. EN.LT.FUN(L+2))GO TO 20
   10 CONTINUE
   20 OU = FUN(L+1) + ((FUN(L+3)-FUN(L+1))/(FUN(L+2)-FUN(L)))*(EN-FUN(L)
     X )
      GO TO 50
   30 OU = FUN(2)
      GO TO 50
   40 OU = FUN(NL2)
   50 CONTINUE
      RETURN
      END
C+++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C******************************************************************
C
      SUBROUTINE PERFO(PI,NTIME,QARS,OARS)
      DIMENSION PI(8)
      DIMENSION QARS(31,8),OARS(31,8)
      DIMENSION DARS(31,8)
      DIMENSION QSDI(8),QSEX(8)
      DO 10 K=11,NTIME
      DO 10 L=1,8
      DARS(K,L)=QARS(K,L)-OARS(K,L)
   10 CONTINUE
      NN=-NTIME
      KK=2
      QSDI(2)=SUMF(DARS,KK,NN,QARS)
      KK=2
      QSEX(2)=SUMF(QARS,KK,NN,QARS)
      KK=3
      QSDI(3)=SUMF(DARS,KK,NN,QARS)
      KK=3
      QSEX(3)=SUMF(QARS,KK,NN,QARS)
      KK=4
      QSDI(4)=SUMF(DARS,KK,NN,QARS)
      KK=4
      QSEX(4)=SUMF(QARS,KK,NN,QARS)
      KK=5
      QSDI(5)=SUMF(DARS,KK,NN,QARS)
      KK=5
      QSEX(5)=SUMF(QARS,KK,NN,QARS)
      KK=6
      QSDI(6)=SUMF(DARS,KK,NN,QARS)
      KK=6
      QSEX(6)=SUMF(QARS,KK,NN,QARS)
      KK=7
      QSDI(7)=SUMF(DARS,KK,NN,QARS)
      KK=7
      QSEX(7)=SUMF(QARS,KK,NN,QARS)
      KK=8
      QSDI(8)=SUMF(DARS,KK,NN,QARS)
      KK=8
      QSEX(8)=SUMF(QARS,KK,NN,QARS)
C
      DO 20 I=2,8
      PI(I)=QSDI(I)/QSEX(I)
      PI(I)=SQRT(PI(I))
      PI(I)=(1.-PI(I))*100.
   20 CONTINUE
      RETURN
      END
      FUNCTION SUMF (X,KK,NN,ORD)
C
C  COMPUTES SUM X OR SUM X**2 FROM A VECTOR
C  X=ARRAY CONTAINING THE SCORES TO BE USED
C  NN=NUMBER OF VALUES TO BE SUMMED. ifNEGATIVE,SUM X**2 COMPUTED
C  KK=ROW OR COLUMN NUMBER ifX IS A MATRIX. SET=1 ifX IS A VECTOR
C  ifKK IS POSITIVE AND NOT 1, IT IS A COLUMN VECTOR
C  ifKK IS NEGATIVE AND NOT 1, IT IS A ROW VECTOR.
C  ND=NUMBER OF ROWS(OR ELEMENTS) DIMENSIONED FOR X  IN THE
C        CALLING PROGRAM
C
      DIMENSION X(31,8),ORD(31,8)
      SUMF=0.0
      N=IABS(NN)
      K=IABS(KK)
      if(NN) 10,110,20
   10 if(KK) 30,110,50
   20 if(KK) 70,110,90
   30 DO 40 I=1,N
   40 SUMF=SUMF+X(K,I)**2
      RETURN
   50 DO 60 I=11,N
      L1=I
      L2=I-1
      IF(I.EQ.11) L2=11
      ORDF=ORD(L1,1)-ORD(L2,1)
      IF(I.EQ.11) ORDF=1.0
   60 SUMF=SUMF+X(I,K)**2*ORDF
      RETURN
   70 DO 80 I=1,N
   80 SUMF=SUMF+X(K,I)
      RETURN
   90 DO 100 I=1,N
  100 SUMF=SUMF+X(I,K)
  110 RETURN
      END
      SUBROUTINE FILES
C
C ASK FOR OUTPUT FILENAME, BBUILD IT AS A PERMANENT FILE ON DISC
C AND OPEN IT AS UNIT 8 WITH READ/WRITE ACCESS.
C ASK FOR INPUT FILENAME, ifNOT SPECIFIED RETURN,
C ELSE OPEN IT AS UNIT 10 IN READ-ONLY MODE.
C
      CHARACTER FILENAME*8, COMD*40
C
C OUTPUT FILE NAME
C
   10 write(7,2001)
2001  format('Output File: ')
      READ (5) FILENAME
C
C COMPOSE BUILD COMMAND (SYSTEMS COMMAND)
C
c      COMD[40:1]=%15C
c      COMD[1:39]='BUILD XXXXXXXX;REC=-80,16,F,ASCII;DISC=500'
c      COMD[7:8]=FILENAME
      IERR=0
c      CALL COMMAND (COMD,IERR,IPARM)
      if(IERR.EQ.0) GOTO 20
C
C ERRORS
C
      if(IERR.EQ.279. AND .IPARM.EQ.100) GO TO 30
      write(7,2002) IERR,IPARM
2002  format( 'Command Failure, Error=',i6,i6)
      write(7,2003) COMD
2003  format(A40)
      GO TO 1000
C
C DUPLICATE FILE
C
   30 write(7,2004)
2004  format('Already exists')
      GO TO 10
C
C FILE CREATED SUCCESSFULLY - ATTACH IT AS UNIT #8
C
c   20 CALL OPENFILE (FILENAME,8,0,IERR)
20      if(IERR.EQ.0) GO TO 50
      write(7,2005) FILENAME,IERR
2005  format('Unable to open',A8,' Error',I6)
      GO TO 1000
C**************************************************************
C ASK FOR INPUT FILE NAME
C
   50 write(7,2006)
2006  format('Input filename: ')
      READ (5) FILENAME
      if(FILENAME.EQ.'        ') GO TO 2000
c      CALL OPENFILE(FILENAME,10,4,IERR)
      if(IERR.EQ.0) GO TO 2000
      write(7,2007) FILENAME,IERR
2007  format('Unable to open',A8,' Error',i6)
 1000 STOP
 2000 RETURN
      END
C+++++++++++++++++++++++++++++++++++++++++++++++++++++
C
C
C                   --MACPUF -- VERSION 78.1 --
C    LIST OF CHANGEABLE PARAMETERS OR FACTORS (NUMBERED 1 TO 30)
C     (THE FIRST 6 ARE PRINTED IN ABBREVIATED FORM WHEN 'MACPUF'
C                       IS FIRST CALLED UP)                      APPROX.
C                                                           NORMAL VALUE
C
C 1.INSPIRED O2, :                                               20.93
C 2.INSPIRED CO2, :                                               0.03
C 3.CARDIAC PUMP PERFORMANCE, AS  :NORMAL (= 5 L/MIN NORMALLY)    100
C  NOW WORKING THROUGH STOKE VOLUME
C 4.METABOLIC RATE, AS  :NORMAL RESTING VALUE0 TO SIM. EXERCISE   100
C 5.EXTRA ANAT. RIGHT-TO-LEFT SHUNT, AS  :CARDIAC OUTPUT           0
C 6.EXTRA DEAD SPACE, IN CC BTPS, ABOVE NORMAL VALUE               0
C 7.LUNG VOLUME, CC BTPS  (END-EXPIRATION)                       3000
C 8.LUNG ELASTANCE, CC H2O/LITRE  (AN INCREASE MAKES BREATHING     5
C    FASTER, AND STIFFER LUNGS REDUCE ILL EFFECTS OF 'PEEP')
C 9.VENOUS ADMIXTURE EFFECT AS  :CARDIAC OUTPUT                    3
C    (SHUNT EFFECT OF FACTOR 9 MODIFIED BY ALV.PO2.  FACTOR 5
C    SPECIFIES FIXED INDEPENDENT SHUNT - EG. CONGEN.HEART DISEASE)
C10.VENTILATORY RESPONSE TO CO2 OR H+ AS  :AVERAGE NORMAL         100
C11.VENTILATORY RESPONSE TO FALLING PO2, AS  :AVERAGE NORMAL      100
C12.'CENTRAL NEUROGENIC (LEARNT) RESPIRATORY DRIVE' AS  :NORMAL   100
C    (RISES IN PROPORTION TO  METABOLIC RATE AND O2 CONSUMPTION)
C13.BAROMETRIC PRESSURE, MM HG (OR KPA -DEPENDS ON INIT.SETTING)  760
C14.BODY TEMPERATURE, DEGREES CENTIGRADE                          37
C15.TISSUE RESP.QUOTIENT (CO2 OUTPUT/O2 UPTAKE)                   0.8
C16.TISSUE CO2 STORES, LITRES STPD                                13
C17.TISSUE ECF DISTRIBUTION VOLUME, LITRES                        12
C18.HAEMOGLOBIN, G/100 ML BLOOD                                  14.8
C19.PACKED CELL VOLUME,                                           45
C20.VENOUS BLOOD VOLUME, ML                                      3000
C21.ADDITION OF BICARBONATE OR ACID, MMOL STANDARD BICARBONATE.    0
C    (ADDITION SPECIFIED IS MADE GRADUALLY OVER SUCCEEDING RUN,
C    THEN VALUE OF FACTOR 21 IS RETURNED TO ZERO.  ifA NEGATIVE
C    VALUE IS ENTERED, THAT NUMBER OF MMOL STRONG ACID ARE
C    ADDED INSTEAD)
C22.BRAIN BICARBONATE, MMOL/L, DEVIATION FROM NORMAL VALUE (+/-)   0
C    (ALLOWS SIMULATION OF CHRONIC ACID/BASE DISTURBANCES.
C    BRAIN HCO3 WILL SLOWLY CHANGE ANYWAY; BUT YOU CAN SPEED UP
C    EQUILIBRATION A LOT BY CHANGING THIS FACTOR APPROPRIATELY)
C23.2,3-DIPHOSPHOGLYCERATE CONC. IN RED CELLS, MMOL/L             3.8
C24.'BREATHING CAPACITY',  :NORMAL AVERAGE VALUE                  100
C    (ACTS ON SUMMATED EFFECTS OF FACTORS 10,11, AND 12 ABOVE,
C    AND GOVERNS COUPLING OF VENTILATORY STIMULI TO RESPONSE).
C25.STATE OF PHYSICAL FITNESS...THRESHOLD FOR SWITCH TO ANAEROBIC  33
C    METABOLISM. >33 LOWERS THE THRESHOLD, THEREBY SIMULATING
C    UNFITNESS.  <33 SIMULATES INCREASED FITNESS. (ARB.UNITS,
C    MM HG, MIXED VENOUS PO2.  RANGE 30-37)
C26.INSPIRATORY/TOTAL BREATH DURATION RATIO                       0.4
C    (I.E. VALUE OF 0.4 MEANS INSPIRATION OCCUPIES 40: OF THE
C    TIME TAKEN FOR ONE COMPLETE RESPIRATORY CYCLE)
C27.MAXIMUM CARDIAC OUTPUT, L/MIN                                 35
C28.LEFT-TO-RIGHT SHUNT, AS RATIO OF CARDIAC OUTPUT -              0
C    (E.G. A VALUE OF 2.0 SPECIFIES A 2/1 SHUNT)
C29.VITAL CAPACITY, LITRES BTPS                                    5
C    (MAXIMUM TIDAL VOLUME IS LIMITED TO 60:  OF THIS VALUE)
C30.POSITIVE END-EXPIRATORY PRESSURE, CM H2O                       0
C
C
C   LIST OF COMPUTED VARIABLES- THE NUMBER IN BRACKETS AFTER EACH IS
C   THE CORRESPONDING FACTOR NUMBER, ALLOWING ANY OF THESE FACTORS TO
C   BE DISPLAYED IN COLUMNS BY USING THE 'RUN CHANGE' OPTION
C
C**N.B. 'NORMAL VALUES' FOR PRESSURES GIVEN IN MM HG,  BUT AN    APPROX.
C    INITIAL CALL FOR 'S.I.UNITS' WILL GIVE ALL IN KPA      NORMAL VALUE
C
CLUNGS********************************** ALVEOLAR/LUNG **************
C   O2- AMOUNT, CC STPD (39)                                     345
C       P.PRESSURE, MM HG (41)                                   100
C       CONTENT IN IDEALISED PULM.CAP.BLOOD, CC/DL (54)           20
C  CO2- AMOUNT, CC STPD (40)                                     145
C       P.PRESSURE, MM HG (42)                                    40
C       CONTENT IN IDEALISED PULM.CAP.BLOOD, CC/DL (53)           47
C   N2- AMOUNT, CC STPD (65)                                    2000
CARTERIES******************************* ARTERIAL BLOOD POOL ********
C   O2- AMOUNT, CC STPD (62)                                     200
C       P.PRESSURE, MM HG (72)                                    92
C       CONTENT, CC/100 ML (49)                                   20
C       CONTENT OF BLOOD LEAVING ART.POOL (94)                    20
C       SATURATION,   MAXIMUM (76)                                97
C  CO2- AMOUNT, CC STPD (63)                                     500
C       P.PRESSURE, MM HG (74)                                    40
C       CONTENT, CC/100 ML (78)                                   50
C       CONTENT OF BLOOD LEAVING POOL (101)                       50
C   N2- P.PRESSURE, MM HG (108)                                  570
C       CONTENT OF BLOOD LEAVING POOL, CC/100 ML (106)            0.8
C HCO3- CONTENT, MMOL/L (60)                                      25
C LACTATE- CONCENTRATION, MMOL/L (90)                             1.0
C   PH-  (33)                                                     7.4
CBRAIN********************************** BRAIN **********************
C   O2- AMOUNT, CC STPD (66)                                      22
C       P.PRESSURE, MM HG, OF BLOOD LEAVING BRAIN (45)            33
C       CONTENT, CC/100 ML, OF BLOOD LEAVING BRAIN (57)           13
C  CO2- AMOUNT, CC STPD (67)                                     650
C       P.PRESSURE, MM HG, OF BLOOD LEAVING BRAIN (46)            55
C       CONTENT, CC/100 ML, OF BLOOD LEAVING BRAIN (58)           56
C HCO3- CONTENT, MMOL/L, OF BLOOD LEAVING BRAIN (22)              22
C         (BUT NOTE THAT EFFECTIVE BRAIN HCO3 IS ALGEBRAIC
C         SUM OF FACTOR 22 AND FACTOR 92 - FORMER=ADAPTATION)
C   PH- AT PUTATIVE CENTRAL CHEMORECEPTOR SITE (36)               7.35
C FLOW- OF BLOOD, ML/100 G. BRAIN PER MINUTE (68)                 55
CTISSUES******************************** LUMPED TISSUE POOL *********
C   O2- AMOUNT, CC STPD (95)                                     175
C       P.PRESSURE, MM HG (96)                                    40
C       CONTENT, CC/100 ML, OF BLOOD LEAVING TISSUES (55)         15
C  CO2- AMOUNT, LITRES STPD (16)                                  15
C       P.PRESSURE, MM HG (97) (TIME SHIFTED...APPROX. VALUE)     47
C       CONTENT, CC/100 ML, OF BLOOD LEAVING TISSUES (66)         55
C   N2- AMOUNT IN FAST-EQUILIBRATING COMPARTMENT, CC STPD (102)   60
C       AMOUNT IN SLOWLY-EQUILIBRATING COMPARTMENT, CC STPD(112)  900
C       AMOUNT HELD ABOVE NORMAL MAX.SATURATION, CC STPD (107)     0
C       ARBITRARY INDEX OF RISK OF DECOMPRESSION SYMPTOMS (83)     0
C        (MAXIMUM SAFE VALUE UP TO 100)
C       P.PRESSURE, MM HG, IN FAST-EQUILIBRATING STORE (103)     570
C       P.PRESSURE, MM HG, IN SLOWLY-EQUILIBRATING STORE (105)   570
C HCO3- CONTENT, MMOL/L, OF BLOOD LEAVING TISSUES (87)            26
C LACTATE- TOTAL AMOUNT IN BODY, MMOL (89)                        35
C   PH- OF BLOOD LEAVING TISSUES (59)                             7.38
C
C
C      LIST OF COMPUTED VARIABLES (CONTINUED)
C
CVEINS********************************** VENOUS BLOOD POOL **********
C   O2- AMOUNT, CC STPD, IN WHOLE POOL (98)                      440
C       P.PRESSURE, MM HG (96) (TIME SHIFTED...APPROX. VALUE)     40
C        (MIXED VENOUS BLOOD P.PRESSURES BOTH OF O2 AND CO2 ARE
C        NOT COMPUTED,  TO ECONOMISE ON COMPUTING TIME. APPROX.
C        TISSUE VALUES ARE USED INSTEAD, HENCE THE TIME SHIFT.
C        BUT THE CONTENTS OF THE GASES IN MIXED VENOUS BLOOD
C        ARE CORRECT, AND HAVE BEEN CORRECTLY DELAYED IN
C        TRANSIT THROUGH THE VENOUS BLOOD POOL)
C       CONTENT, CC/100 ML, OF BLOOD IN PULMONARY ARTERY (31)     15
C  CO2- AMOUNT, CC STPD, IN VENOUS BLOOD POOL (50)               1600
C       P.PRESSURE, MM HG (97) - SEE NOTE ABOVE FOR O2            47
C       CONTENT, CC/100 ML, OF BLOOD IN PULMONARY ARTERY (61)     55
C HCO3- CONTENT, MMOL/L, OF MIXED VENOUS BLOOD (88)               27
C   PH- OF MIXED VENOUS BLOOD (34)                                7.38
CBAG*************************** BAG FOR COLLECTION OR REBREATHING ***
C VOL.- CC BTPS (116)             (ALL THESE REMAIN)               0
C   O2- AMOUNT, CC STPD (37)      (UNCHANGED WHILE BAG)            0
C  CO2- AMOUNT, CC STPD (38)      (IS DISCONNECTED)                0
COTHERS********************************* MISC. OTHER VALUES *********
CCARDIAC OUTPUT-ACTUAL EFFECTIVE CARDIAC OUTPUT, L/MIN (93)       4.8
CDEAD SPACE -   TOTAL EFFECTIVE PHYSIOLOGICAL, CC BTPS (70)       130
CRESPIRATORY EXCHANGE RATIO  (69)  (CO2 OUTPUT IN LAST ITERATION  0.8
C               INTERVAL, DIVIDED BY O2 CONSUMPTION.  A NORMAL
C               VALUE SHOWS THAT THERE IS A STEADY STATE)
CRESP. RATE   - CYCLES/MINUTE (48)                                14
CTIDAL VOL.   - CC BTPS (47)                                      450
CVEN.ADMIXT.  - TOTAL EFFECTIVE ADMIXT., AS   CARDIAC OUTPUT (80)  3
CVENTILATION
C      TOTAL  - LITRES/MIN, BTPS (51)                             6.5
C   ALVEOLAR  - LITRES/MIN, BTPS (35)                             4.2
C                            ERROR MESSAGES
C                            --------------
C  FACTOR     MEANING         PROBABLE            SUGGESTED
C NEGATIVE    OF ERROR         CAUSE                REMEDY
C
C     0     TIDAL VOL.TOO    REBREATHING      USE LARGER BAG OR
C           LARGE FOR BAG   BAG TOO SMALL      SHORTEN RUN
C      OR...PUL.CAP.BLOOD   SUDDEN FALL IN     CHANGE CO2 OR VENTILATION
C           HCO3 FELL TOO   ALVEOLAR PCO2      MORE SLOWLY.  ifTHIS IS
C           FAST TO ALLOW  (E.G. SUDDEN        IMPOSSIBLE, SHORTEN TIME
C           EQUILIBRATION   HYPERVENTILATION)  INTERVAL AND AND RERUN
C    41     ALVEOLAR  O2    SUDDEN FALL        CHANGE O2 OR BAROMETR.
C           LESS THAN 0     IN ALV.PO2         PRESS. MORE SLOWLY OR
C                                              SHORTEN TIME INTERVAL
C    42     ALVEOLAR CO2    SUDDEN FALL        CHANGE CO2 OR VENTILATION
C           LESS THAN 0     IN ALV. PCO2       OR ADD HCO3 MORE SLOWLY
C                                              OR SHORTEN TIME INTERVAL
C    60     ART. HCO3       SUDDEN FALL IN     SHORTEN TIME INTERVAL
C           LESS THAN 0     ALV.PCO2 OR TOO    CONSIDERABLY AND RERUN
C                           MUCH ACID GIVEN    AND/OR GIVE ACID MORE
C                           OR MADE TOO        SLOWLY
C                           QUICKLY
C    87     TISSUE HCO3     VERY RAPID ADDN.   ADD ACID MORE SLOWLY
C           LESS THAN 0     OF ACID OR TOO     OR RERUN AT MUCH SHORTER
C                           RAPID GEN. OF      TIME INTERVAL
C                           LACTIC ACIDOSIS
C    88     VENOUS HCO3     TOO RAPID ADDN.    ADD ACID MORE SLOWLY
C           LESS THAN 0     OF ACID
C    95     TISSUE OXYGEN   NOT ENOUGH TIME    SHORTEN TIME INTERVAL
C           LESS THAN 0     FOR ANAEROBIC MET.   AND RERUN
C                           TO GET GOING
C
C
C      FURTHER LIST OF USEFUL NUMBERED VARIABLES, FROM 31 TO 116
C
C (ALL THESE VARIABLES ARE COMPUTED AT EACH ITERATION INTERVAL DURING
C  A RUN AND CAN BE DISPLAYED IN COLUMNS BY USING THE '4.RUN CHANGE'
C  OPTION, ASKING FOR '3.SELECTED VALUES' AND SPECIFYING THE NUMBERS)
C                                                                APPROX.
C                                                           NORMAL VALUE
C31.VENOUS O2 CONTENT, CC/100 ML, OF BLOOD IN PULMONARY ARTERY        15
C33.ARTERIAL PH:                                                     7.4
C34.VENOUS PH: OF MIXED VENOUS BLOOD                                7.38
C35.ALVEOLAR VENTILATION: LITRES/MIN, BTPS                           4.2
C36.BRAIN PH: AT PUTATIVE CENTRAL CHEMORECEPTOR SITE                7.35
C37.BAG : AMOUNT OF O2, CC STPD                                        0
C38.BAG : AMOUNT OF CO2 , CC STPD                                      0
C39.ALVEOLAR O2: AMOUNT, CC STPD                                     345
C40.ALVEOLAR CO2: AMOUNT, CC STPD                                    145
C41.ALVEOLAR PO2, MM HG                                              100
C42.ALVEOLAR PCO2, MM HG                                              40
C45.BRAIN PO2, MM HG, OF BLOOD LEAVING BRAIN                          33
C46.BRAIN PCO2, MM HG, OF BLOOD LEAVING BRAIN                         55
C47.TIDAL VOL. : CC BTPS                                             450
C48.RESPIRATORY RATE : CYCLES/MINUTE                                  14
C49.ARTERIAL O2 CONTENT, CC/100 ML                                    20
C51.TOTAL VENTILATION: LITRES/MIN, BTPS                              6.5
C60.ARTERIAL HCO3: CONTENT, MMOL/L                                    25
C61.VENOUS CO2 CONTENT, CC/100 ML, OF BLOOD IN PULMONARY ARTERY       55
C65.ALVEOLAR N2: AMOUNT, CC STPD                                    2000
C66.BRAIN O2: AMOUNT, CC STPD                                         22
C68.BRAIN FLOW OF BLOOD, ML/100 G. BRAIN PER MINUTE                   55
C69.RESPIRATORY EXCHANGE RATIO                                       0.8
C70.DEAD SPACE - TOTAL EFFECTIVE PHYSIOLOGICAL, CC BTPS              130
C72.ARTERIAL PO2, MM HG                                               92
C74.ARTERIAL PCO2, MM HG                                              40
C75.ALVEOLAR VENTILATION: LITRES/MIN, BTPS                           4.2
C76.ARTERIAL O2 SATURATION, : MAXIMUM                                 97
C78.ARTERIAL CO2 CONTENT, CC/100 ML                                   50
C80.VEN.ADMIXT.: TOTAL EFFECTIVE ADMIXT., AS : CARDIAC OUTPUT          3
C83.TISSUE N2 ARBITRARY INDEX OF RISK OF DECOMPRESSION SYMPTOMS        0
C88.VENOUS HCO3: CONTENT, MMOL/L, OF MIXED VENOUS BLOOD               27
C89.TISSUE LACTATE: TOTAL AMOUNT IN BODY, MMOL                        35
C90.ARTERIAL LACTATE: CONCENTRATION, MMOL/L                          1.0
C93.CARDIAC OUTPUT:ACTUAL EFFECTIVE CARDIAC OUTPUT, L/MIN            4.8
C95.TISSUE O2: AMOUNT, CC STPD                                       175
C96.VENOUS PO2, MM HG (APPROX. VALUE ONLY - TIME SHIFTED)             40
C         (MIXED VENOUS BLOOD P.PRESSURES BOTH OF O2 AND CO2 ARE
C         NOT COMPUTED SEPARATELY, TO ECONOMISE ON COMPUTING TIME:
C         BUT THE CONTENTS OF THE GASES IN MIXED VENOUS BLOOD
C         ARE CORRECT, AND HAVE BEEN CORRECTLY DELAYED IN
C         TRANSIT THROUGH THE VENOUS BLOOD POOL)
C97.VENOUS PCO2, MM HG                                                47
C102.TISSUE N2: AMOUNT IN FAST-EQUILIBRATING COMPARTMENT, CC STPD     60
C103.TISSUE N2 P.PRESSURE, MM HG, IN FAST-EQUILIBRATING STORE        570
C105.TISSUE N2 P.PRESSURE, MM HG, IN SLOWLY-EQUILIBRATING STORE      570
C107.TISSUE N2 AMOUNT HELD ABOVE NORMAL MAX.SATURATION, CC STPD        0
C108.ARTERIAL N2: P.PRESSURE, MM HG                                  570
C109.HEART RATE
C110.HEART STROKE VOLUME
C112.TISSUE N2 AMOUNT IN SLOWLY-EQUILIBRATING COMPARTMENT, CC STPD   900
C116.BAG VOL.: CC BTPS                                                 0

CMessage  4:
C>From hp4nl!hp4nl.nluug.nl!HSCvax.CSU.McMaster.CA!NLJONES Thu Aug  2 04:05:07 1990
CReturn-Path: <hp4nl!hp4nl.nluug.nl!HSCvax.CSU.McMaster.CA!NLJONES>

