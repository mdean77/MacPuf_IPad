// THIS IS THE ORIGINAL FORTRAN CODE BUT I HAVE STRIPPED IT DOWN AND // TRIED TO ALLOCATE PARTS OF IT TO OBJECTS THAT ARE USED IN THE NEW MODEL.//// J. MICHAEL DEAN, MD, MARCH 9 2002//// NOTE THAT THIS FILE IS NOT COMPILABLE SOURCE CODE!  FOR REFERENCE USE ONLY.170     CALL MINIT(LL1,LL3,LL4,NREPT,SIMLT)190     CALL CONST(C,NREPT,SIMLT)        DO 1590 MORAN=1,NREPT        // HEART OBJECT HANDLES MOST OF THIS SECTION        C	Increase cardiac output if O2 supplied is low                Y=RO2CT*.056        220     IF (Y-.35) 230,240,240        230     Y=.35                C	COADJ is adjusted cardiac output used mainly as index FTCO        C	which takes account of cardiac output per unit time.        C	Cardiac output goes up as oxygen consumption goes up.        240     COADJ=DAMP((C8/Y+C9/(Y**2))*C16,COADJ,C(61))                IF (CO-3.) 250,260,260        C	If heart stops make output instantly zero (error value)        250     COADJ=E                GO TO 280        C	Limit the maximum cardiac output        260     IF (COADJ-COMAX) 280,280,270        270     COADJ=COMAX        C	FTCO is number of deciliters of cardiac output per time interval        280     FTCO=C17*COADJ                FTCOC=FTCO*(1.-C(69)*COADJ)                // HUMAN HANDLES DPG CHANGES                DPG=DPG+(23.3-RO2CT-DPG)*C10        // VENOUS ADMIXTURE CALCULATIONS  BY HUMAN OBJECT                X=AO2PR                IF (X-200.) 300,300,290        290     X=200.        C	IF alveolar O2 very high then increase effective venous admixture        300     Y=AO2PR                IF (Y-600.) 320,320,310        310     Y=600.        320     IF (AO2PR-400.)340,340,330        330     X=X-(Y-400.)*.3        340     IF (X-55.) 350,350,360        350     X=55.        C	PW is eff. ven. admix. affected by PEEP, alv O2, etc	        C	and incorporates fixed shunt component, FADM        360     PW=(C18/X+C19)*C21+FADM        C	Limit ridiculous admixtures in excess of unity                IF (PW-100.)380,380,370        370     PW=100.// ARTERIAL POOL HANDLES MOST OF THE FOLLOWING        380     X=PW*.01                PC=1.-X                RN2MT=RN2MT+FTCO*((X*TN2PR+PC*(C11-AO2PR-AC2PR))*.00127-EN2CT)                U=X*VC2CT+PC*PC2CT                V=X*VO2CT+PC*PO2CT                  RC2MT=RC2MT+FTCO*(U-EC2CT)                RO2MT=RO2MT+FTCO*(V-EO2CT)                W=C22/COADJ                IF (W-100.) 400,400,390        390     W=0.        400     EO2CT=DAMP(RO2MT*.1,EO2CT,W)                EC2CT=DAMP(RC2MT*.1,EC2CT,W)                EN2CT=DAMP(RN2MT*.1,EN2CT,W)                Z=COADJ*C17        C        C  		R-2CT IS CONTENT REACHING CHEMOCEPTORS        C                RO2CT=DAMP(V,RO2CT,Z)                RC2CT=DAMP(U,RC2CT,Z)                RC3CT=C3*(RC2PR-40.)+VC3MT*C1                IF (RC3CT) 940,940,410 // 940 IS DEATH ROUTINE        410     RPH=PHFNC(RC3CT,RC2PR)                CALL GSINV (RO2PR,RC2PR,RO2CT,RC2CT,RPH,SAT)                PJ=SAT*100.        490     U=FT*(ABS(SVENT)**C4*C5+COADJ+C7)// TISSUE OBJECT HANDLES MOST THE FOLLOWING        500     TO2MT=TO2MT+FTCOC*(EO2CT-TO2CT)-U+XLACT                IF (TO2MT-E) 940,940,510        C        C 	    COMPUTE TISS PO2 DAMPING APPROPRIATELY        C        510     TO2PR=DAMP(TO2MT*C31,TO2PR,C(55))                X=TO2MT-250.                IF (X) 530,530,520        C        C       NEXT SECTION DEALS WITH LACTATE METABOLISM        C        520     TO2PR=45.+.09*X        530     Y=RLACT*C29                W=CBF*.019                IF (W-1.) 536,536,534        534     W=1.        536     X=TPH*10.-69.                IF (X-W) 550,550,540        540     X=W        550     Z=Y*(X*.8612+.0232*2.**((8.-TPH)*3.33)+COADJ*.01)                W=C(70)/(W+.3)                V=FITNS-TO2PR                IF (V) 570,570,560        560     W=W+C42*(V+1.)**4                Z=Z*TO2PR*.04        570     X=2.04*(W-C32)                IF (X-U) 590,590,580        580     X=U        590     XLACT=DAMP(X,XLACT,C(53))        C        C 		LIMIT OF RATE OF LACTATE FORM DETRMINED BY METAB. DRIVE        C 		TO TISSUES (I.E. LEVEL OF EXERCISE) AND BODY SIZE            C                IF (W-C40) 610,610,600        600     W=C40        C        C       REDUCE LACTATE CATABOLISM IF CARD. OUTPUT LESS THAN 1/3 NORMAL        C 		TO TAKE ACCOUNT OF DIMINISHED LIVER AND KIDNEY FLOWS        C        610     X=C24-COADJ                IF (X)630,630,620        620     Z=Z*COADJ/C24        C        C 	INCR. TOTAL LACTIC BY DIFFERENCE BETWEEN PRODUCT. AND CATABOLISM        C        630     V=W-Z                TLAMT=TLAMT+V                RLACT=DAMP(TLAMT*C15,RLACT,COADJ*C(55))        C        C 		TISSUE CO2 EXCHANGES; U=METAB.  .001 CONVERTS CC TO LITERS        C        640     X=(TN2PR-SN2PR)*C(60)                TN2MT=TN2MT+FTCOC*(EN2CT-TN2PR*.00127)-X                SN2MT=SN2MT+X                Y=(SN2MT*C26-C11)*C27                IF (Y) 650,650,660        650     Y=Y*.3                IF(UN2MT) 670,670,660        660     SN2MT=SN2MT-Y                BUBBL=UN2MT**1.2*C23                UN2MT=UN2MT+Y        670     SN2PR=SN2MT*C26                TN2PR=TN2MT*C28                TC2MT=TC2MT+(FTCOC*(EC2CT-TC2CT)+TRQ*U)*.001        C        C 		COMPUTE PARTIAL PRESSURE FROM TOTAL CO2 AND BICARB (STAND)        C                        TC2PR=(TC2MT*C30-TC3MT*C36+C33)*C43                FY=TC2PR-TC2RF                TC2RF=TC2PR        C        C 	0.4 IN LINE BELOW REPRESENTS LACTATE BUFFERS INSIDE CELLS SO BICARB        C 	DISPLACEMENT IS LESS THAN MOLAR EQUIVALENCE        C                TC3MT=TC3MT+FTCOC*.1*(VC3MT*C1-TC3MT*C13)-.4*V                Y=(TC2PR-40.)*C3        690     TC3CT=TC3MT*C13+Y                IF (TC3CT) 940,940,700  // 940 IS DEATH        700     TPH=PHFNC(TC3CT,TC2PR)                CALL GASES(TO2PR,TC2PR,TO2CT,TC2CT,TPH,SAT)        // VENOUS POOL HANDLES MOST OF THE FOLLOWING        C        C 	AMOUNTS OF GASES IN VEN. POOL INC. BY ARRIVING BLOOD FROM TISSUES        C 	AND DEC. BY BLOOD GOING TO LUNGS; SAME FOR BICARB.  VENOUS CONTENT        C 	THEN DETERMINED (V-2CT)        C                X=C(69)*COADJ*FTCO                VC2MT=VC2MT+FTCOC*TC2CT-FTCO*(VC2CT*C14-RC2CT*SHUNT)+X*EC2CT                VO2MT=VO2MT+FTCOC*TO2CT-FTCO*(VO2CT*C14-RO2CT*SHUNT)+X*EO2CT                VC3MT=VC3MT+FTCOC*.1*(TC3MT*C13-VC3MT*C1)+ADDC3                X=TC3AJ*C10                TC3AJ=TC3AJ-ADDC3+V-X                TC3MT=TC3MT-FY*C(64)+X*.67                VO2CT=VO2MT*C2                VC2CT=VC2MT*C2                CALL DELAY                VC3CT=VC3MT*C1+Y                IF (VC3CT) 940,940,710 // 940 IS DEATH        710     VPH=PHFNC(VC3CT,TC2PR)                GO TO 740        // LUNGS HANDLE THE NEXT SECTION                C 		THIS SECTION - RARELY NEEDED - IS FOR DIFFUSION RESPIRATION        C        720     FD=XVENT*C12                AO2MT=AO2MT-FD*FIO2                AC2MT=AC2MT-FD*FIC2                AN2MT=AN2MT-FD*Z                GO TO 850        730     QA=.001                QB=E                GO TO 840        C        C 		NEXT LONG SECTION DEALS WITH GAS EXCHANGE IN LUNGS        C 		PC IS FRACTION OF CO PERFECTLY MIXED WITH ALV GAS        C 		U AND V ARE AMTS OF GASES PER UNIT FRACTION TIME (FT)        C        740     PC=FTCO*C14*PC                X=AVENT*C12                U=X*FIO2                V=X*FIC2        C        C 		NEXT 2 STS. COMPUTE NEW AMTS GAS IN LUNG; W IS NOMINAL        C 		RESPIRATION VOLUME (INSPIRATION)        C                AO2MT=AO2MT+U                AC2MT=AC2MT+V                Z=100.-FIO2-FIC2                AN2MT=AN2MT+AVENT*C12*Z                W=AO2MT+AC2MT+AN2MT        C        C 		NOW CALCULATE ALVEOLAR PARTIAL PRESSURES        C                X=C11/W                PO2=AO2MT*X                PC2=AC2MT*X        C        C 		NOW CHANGE ALVEOLAR AMOUNTS IN ACCORD WITH BLOOD GASES        C                AO2MT=AO2MT+PC*(VO2CT-PO2CT)                AC2MT=AC2MT+PC*(VC2CT-PC2CT)                AN2MT=AN2MT+PC*(TN2PR*.00127-EN2CT)                PC=AO2MT+AC2MT+AN2MT                IF (PL-2.) 750,770,750        750     IF (AVENT-20.) 770,760,760        760     FY=(PC-W)*C34/RRATE                GO TO 780        770     FY=0.        780     IF (PL) 790,800,800        790     CALL BAGER (5,PC,X,C12,SIMLT)        C        C 		XVENT IS EXHALED VOL. IN FT DOWN TO RESTING LUNG VOLUME        C 		IF THIS IS NEG THEN DIFFUSION RESP OCCURS        C        800     XVENT=PC*C35-VLUNG                IF (XVENT) 720,810,810        810     DVENT=XVENT*C25/PC                Y=DVENT*AO2MT                Z=DVENT*AC2MT                PC=DVENT*AN2MT                QA=U-Y                QB=Z-V                IF (PL-.5) 830,830,820        820     CALL BAGER(4,XVENT,DVENT,C12,SIMLT)                IF (DVENT+9000.) 940,830,830        830     IF (AVENT-E) 730,730,840        C        C 		SET NEW AMTS OF EACH GAS AND CALC PARTIAL PRESSURES        C        840     AO2MT=AO2MT-Y                AC2MT=AC2MT-Z                AN2MT=AN2MT-PC        850     U=C11/(AO2MT+AC2MT+AN2MT)        C        C 		TAKE ACCOUNT OF I:E RATIO (BELIEVE IT OR NOT)        C                        V=C37/RRATE                IF (V-4.)870,870,860        860     V=4.        870     IF (AVENT-20.) 880,890,890        880     V=0.        C        C 		SPEED OF CHANGE IN ALV GAS TENSIONS IS FUNC OF TIDAL VOL        C        890     X=(TIDVL+100.)*C38        C        C 		COMPUTE END EXPIRATORY PARTIAL PRESSURES        C                Y=AO2MT*U                Z=AC2MT*U                AO2PR=DAMP((Y+(PO2-Y)*V),AO2PR,X)                AC2PR=DAMP((Z+(PC2-Z)*V),AC2PR,X)                IF (AO2PR-E) 940,940,900        900     IF (AC2PR-E) 940,940,910        910     IF (QA) 920,930,920        920     PC=QB/QA        930     X=VC3MT*C1+C3*(AC2PR-40.)                IF (X-E) 940,950,950        940     LL5=-1                GO TO 1455        950     Y=PHFNC(X,AC2PR)                CALL GASES(AO2PR,AC2PR,PO2CT,PC2CT,Y,SAT)// BRAIN OBJECT HANDLES NEXT SECTION                C 		THE NEXT SECTION COMPUTES CEREBRAL BLOOD FLOW IN RELATION        C 		TO CARDIAC OUTPUT AND BRAIN PCO2 SENSITIVITY        C 		THIS SECTION CAN BE ALTERED WITH DAVE WILSON'S MODEL???        C                Z=SQRT(COADJ)*.5                IF (Z-1.)970,970,960        960     Z=1.        970     Y=(7.4-BPH)*(BC2PR*.0184-BC3AJ*.1)                IF (Y) 990,990,980        980     Y=300.*Y**2        990     IF (Y-4.4) 1010,1010,1000        1000    Y=4.4        1010    CBF=DAMP((Y-.12)*42.5*Z,CBF*Z,C(55))                Y=CBF*C39        C        C 		COMP. BRAIN GASES BY METAB. SSUMING RQ .98 AND ALLOWING FOR         C 		DIFFERENT AMTS SUPPLIED IN ART BLOOD AND LEAVING VEN BLOOD        C 		CALCULATE TENSIONS BY GUESSTIMATED DISSOCIATION CURVES        C                X=C41*(BO2AD+.25)                Z=X                IF (BO2PR-18.) 1020,1020,1040        1020    Z=X*(BO2PR*.11-1.)                X=X*(19.-BO2PR)                IF (Z)1030,1040,1040        1030    Z=0.        1040    BO2MT=BO2MT+Y*(RO2CT-BO2CT)-2.*Z*(BO2AD+.1)                IF (BO2MT) 1050,1050,1060        1050    BO2MT=.1        1060    BC2MT=BC2MT+Y*(RC2CT-BC2CT)+2.15*X                BO2PR=BO2MT*1.6                BC2PR=BC2MT*.078                W=BC2PR-40.                Y=BC3CT+BC3AJ+.2*W        C        C 		A SMALL PROPORTION OF ADDED BICARB GOES TO CSF AND AFFECTS        C 		BREATHING APPROPRIATELY        C                BC3AJ=BC3AJ+((RC3CT-24.)*.3-BC3AJ)*C42        C        C 		ADJ BICARB TO PCO2 THEN CALCULATE BRAIN PH AT RECEPTOR        C 		THEN CALCULATE GAS CONTENTS LEAVING THE BRAIN        C                X=PHFNC(2.*Y+RC3CT,2.*BC2PR+RC2PR)                Z=((ABS(X-BPH)+E)*100.)**2+.04                IF (Z-C17) 1080,1080,1070        1070    Z=C17        1080    BPH=DAMP(X,BPH,Z)        C        C 		RESTRICT RATE OF CHANGE OF BRAIN RECEPTOR PH        C                Z=PHFNC(VC3MT*C1+(BC2PR-40.)*C3,BC2PR)                CALL GASES(BO2PR,BC2PR,BO2CT,BC2CT,Z,SAT)// THIS SECTION MOSTLY HANDLED BY LUNGS BUT HAS SOME BRAIN INTERACTION                C 		NOW VENTILATION CALCULATIONS; DEAD SPACE, ANATOMIC, ETC.        C                IF (NARTI)1090,1090,1100        1090    DVENT=C(51)        C        C 	NAT VENT CONTROLS = SUM OF CENTRAL CO2 RECEPTOR DRIVE, O2 LACK        C 	RECEPTOR, CENTRAL NEUROGENIC DRIVE, PLUS VENTILATOR IF NARTI        C 	IS SET.        C        1100    Y=(118.-PJ)*.05                Z=Y*.002                X=(C(65)+Z-BPH)*1000.*Y                IF (X) 1110,1120,1120        1110    X=0.        1120    W=(C(66)+Z-BPH)*150.*Y        C        C 	HIGH BRAIN PH OR LOW PCO2 ONLY INHIBITS VENTILATION IF INTRINSIC        C 	CENTRAL DRIVE IS REDUCED OR ABSENT (LEARNT DRIVE)        C                IF(W) 1130,1150,1150        1130    IF (C(67)) 1150,1150,1140        1140    W=0.        1150    Z=(BC2PR-120.)*.25                IF (Z) 1160,1170,1170        1160    Z=0.        1170    Y=(98.-PJ)*(RC2PR-25.)*.12                IF (Y) 1180,1190,1190        1180    Y=0.        C        C 		BO2AD IS INDEX OF BRAIN OXYGENATION ADEQUACY        C 		AND LOWERS AND EVENTUALLY STOPS BREATHING IF TOO LOW        C        1190    U=BO2PR-11.                IF (U) 1210,1200,1200        1200    U=1.                GOTO 1220        1210    U=0.        1220    BO2AD=DAMP(U,BO2AD,C(63))        C        C 		PREVENT IMMEDIATE CHANGE IN SPEC. VENT. CAPACITY        C                XRESP=DAMP(C(46),XRESP,C(68))                U=(C44*(X+W)+C(45)*Y+XRESP-Z)*C(47)                IF (U-C6) 1240,1240,1230        1230    U=C6        1240    X=(COADJ+5.)*C(62)/(TIDVL+400.)                SVENT=BO2AD*DAMP(U,SVENT,X)                IF (PL) 1280,1250,1250        C        C 		IF VENT STIMULI INADEQUATE THEN APNEA        C        1250    IF (SVENT-C(48)) 1260,1260,1290        1260    IF (NARTI) 1290,1290,1280        1280    DVENT=E                RRATE=.0001                GOTO 1350        C        C 		RESP RATE CALC FROM CONSTANT +ELASTANCE+TOTAL VENT + ART PO2        C        1290    IF (NARTI) 1320,1320,1300        1300    DVENT=SVENT                RRATE=(C(49)+DVENT**.7*.37)*C(50)/(PJ+40.)                IF (RRATE-1.) 1350,1350,1310        1310    IF (COADJ-.5) 1350,1350,1320        C        C 	CALC DYNAMIC DEAD SPACE AS SUM OF ANAT FACTORS AND V/Q FACTORS        C        1320    U=AO2PR*.15                IF (U-70.) 1340,1340,1330        1330    U=70.        1340    DSPAC=DAMP((C(52)+DVENT*100./RRATE**1.12+20.*DVENT/(COADJ+            /  5.)+U+FY+C(54)*(TIDVL+500.)),DSPAC,C(55))        1350    TIDVL=DVENT*1000./RRATE        1360    AVENT=(TIDVL-DSPAC)*RRATE*FT                IF (NARTI) 1380,1380,1365        1365    X=TIDVL-C20                IF (X)1380,1380,1370        1370    TIDVL=C20                RRATE=DVENT*1000./TIDVL                GOTO 1360        1380    IF (AVENT) 1390,1390,1400        1390    AVENT=E        1400    FVENT=AVENT*C(56)// HUMAN HANDLES THE FOLLOWING        C 	CONVERT ALL PRESSURES FROM MM HG TO SI IF PREVIOUSLY REQUESTED        C 	BEFORE OUTPUT        C        1515    CALL UNITS(1,SIMLT)        C 	CONVERT ALL PRESSURES BACK BEFORE CONTINUING        C        1580    CALL UNITS(2,SIMLT)        1590    CONTINUE        C        C 	RESET BICARBONATE        C                ADDC3=0.